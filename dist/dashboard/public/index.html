<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPECMEM // TACTICAL MEMORY OPERATIONS</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#128293;</text></svg>">
    <style>
        /* ============================================
         * SPECMEM DASHBOARD - Professional Edition
         * Modern tactical theme with enhanced visuals
         * Lead Engineer: ENG1 | 2025-12-13
         * ============================================ */

        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Primary Colors */
            --csgo-yellow: #FFD700;
            --csgo-yellow-dark: #B8860B;
            --csgo-yellow-light: #FFE44D;
            --csgo-yellow-glow: rgba(255, 215, 0, 0.5);
            --csgo-yellow-subtle: rgba(255, 215, 0, 0.1);

            /* Background Colors */
            --csgo-black: #000000;
            --csgo-dark: #0a0a0a;
            --csgo-darker: #050505;
            --csgo-gray: #1a1a1a;
            --csgo-gray-light: #2a2a2a;
            --csgo-gray-medium: #3a3a3a;

            /* Text Colors */
            --csgo-text: #e0e0e0;
            --csgo-text-dim: #888888;
            --csgo-text-muted: #666666;

            /* Status Colors */
            --csgo-success: #4CAF50;
            --csgo-success-glow: rgba(76, 175, 80, 0.5);
            --csgo-error: #f44336;
            --csgo-error-glow: rgba(244, 67, 54, 0.5);
            --csgo-warning: #ff9800;
            --csgo-warning-glow: rgba(255, 152, 0, 0.5);
            --csgo-info: #2196F3;
            --csgo-info-glow: rgba(33, 150, 243, 0.5);

            /* UI Elements */
            --csgo-border: #333333;
            --csgo-border-light: #444444;

            /* Glassmorphism */
            --glass-bg: rgba(26, 26, 26, 0.8);
            --glass-border: rgba(255, 215, 0, 0.2);
            --glass-blur: blur(10px);

            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-yellow: 0 4px 20px rgba(255, 215, 0, 0.2);
            --shadow-yellow-strong: 0 0 30px rgba(255, 215, 0, 0.4);

            /* Animation Timings */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-bounce: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        body {
            font-family: 'Rajdhani', 'Segoe UI', sans-serif;
            background: var(--csgo-black);
            color: var(--csgo-text);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Enhanced animated background with grid and gradient overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at top, rgba(255,215,0,0.03) 0%, transparent 50%),
                linear-gradient(90deg, rgba(255,215,0,0.02) 1px, transparent 1px),
                linear-gradient(rgba(255,215,0,0.02) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            pointer-events: none;
            z-index: 0;
            animation: gridPulse 8s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(255,215,0,0.05) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* ============================================
         * HEADER - Professional Tactical Style
         * ============================================ */

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: linear-gradient(180deg, rgba(15, 15, 15, 0.98) 0%, rgba(5, 5, 5, 0.98) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--csgo-yellow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 1000;
            box-shadow:
                0 4px 30px rgba(255, 215, 0, 0.15),
                inset 0 -1px 0 rgba(255, 215, 0, 0.1);
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 22px;
            font-weight: 700;
            color: var(--csgo-yellow);
            text-shadow: 0 0 20px var(--csgo-yellow-glow);
            letter-spacing: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: default;
            transition: var(--transition-normal);
        }

        .logo:hover {
            text-shadow: 0 0 30px var(--csgo-yellow-glow), 0 0 60px rgba(255, 215, 0, 0.3);
        }

        .logo::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--csgo-yellow);
            border-radius: 50%;
            animation: logoPulse 2s ease-in-out infinite;
            box-shadow: 0 0 10px var(--csgo-yellow);
        }

        @keyframes logoPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }

        .logo span {
            color: var(--csgo-text-dim);
            font-weight: 400;
            font-size: 14px;
            letter-spacing: 2px;
        }

        .header-stats {
            display: flex;
            gap: 24px;
            font-size: 14px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 16px;
            background: rgba(255, 215, 0, 0.03);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 6px;
            transition: var(--transition-normal);
            min-width: 80px;
        }

        .stat-item:hover {
            background: rgba(255, 215, 0, 0.08);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 600;
            color: var(--csgo-yellow);
            text-shadow: 0 0 10px var(--csgo-yellow-glow);
            transition: var(--transition-fast);
        }

        .stat-value.updating {
            animation: statBounce 0.3s ease;
        }

        @keyframes statBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .stat-label {
            font-size: 9px;
            color: var(--csgo-text-dim);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        #language-selector-container {
            display: flex;
            align-items: center;
            margin-left: auto;
            margin-right: 16px;
        }

        /* ============================================
         * NAVIGATION - Professional Side Panel
         * ============================================ */

        .nav-panel {
            position: fixed;
            left: 0;
            top: 64px;
            bottom: 0;
            width: 76px;
            background: linear-gradient(135deg, rgba(15, 15, 15, 0.95) 0%, rgba(5, 5, 5, 0.98) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 215, 0, 0.15);
            display: flex;
            flex-direction: column;
            padding: 16px 0;
            z-index: 999;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-panel::-webkit-scrollbar {
            width: 3px;
        }

        .nav-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 14px 8px;
            margin: 2px 8px;
            cursor: pointer;
            transition: all var(--transition-normal);
            border-left: 3px solid transparent;
            border-radius: 0 6px 6px 0;
            position: relative;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(255, 215, 0, 0.08);
            border-left-color: var(--csgo-yellow);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%);
            border-left-color: var(--csgo-yellow);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            right: -1px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 6px solid var(--csgo-gray);
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 6px;
            color: var(--csgo-text-dim);
            transition: all var(--transition-normal);
            filter: grayscale(0.5);
        }

        .nav-item:hover .nav-icon,
        .nav-item.active .nav-icon {
            color: var(--csgo-yellow);
            text-shadow: 0 0 15px var(--csgo-yellow-glow);
            filter: grayscale(0);
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--csgo-text-muted);
            font-weight: 500;
            text-align: center;
            line-height: 1.2;
        }

        .nav-item:hover .nav-label,
        .nav-item.active .nav-label {
            color: var(--csgo-text);
        }

        /* Navigation tooltip on hover */
        .nav-item::before {
            content: attr(data-tooltip);
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            background: var(--csgo-yellow);
            color: var(--csgo-black);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            pointer-events: none;
            z-index: 1000;
        }

        .nav-item:hover::before {
            opacity: 1;
            visibility: visible;
        }

        /* ============================================
         * MAIN CONTENT AREA
         * ============================================ */

        .main-content {
            margin-left: 76px;
            margin-top: 64px;
            padding: 24px;
            min-height: calc(100vh - 64px);
            position: relative;
            z-index: 1;
        }

        /* ============================================
         * MODAL SYSTEM - CS:GO Inventory Style
         * ============================================ */

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: linear-gradient(135deg, var(--csgo-dark) 0%, var(--csgo-black) 100%);
            border: 2px solid var(--csgo-yellow);
            border-radius: 4px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-shadow:
                0 0 30px rgba(255, 215, 0, 0.3),
                inset 0 0 100px rgba(255, 215, 0, 0.05);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Weapon skin style corner accents */
        .modal::before,
        .modal::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            border: 2px solid var(--csgo-yellow);
            pointer-events: none;
        }

        .modal::before {
            top: -2px;
            left: -2px;
            border-right: none;
            border-bottom: none;
        }

        .modal::after {
            bottom: -2px;
            right: -2px;
            border-left: none;
            border-top: none;
        }

        .modal-header {
            background: linear-gradient(90deg, var(--csgo-yellow) 0%, var(--csgo-yellow-dark) 100%);
            color: var(--csgo-black);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--csgo-black);
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .modal-close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 20px;
            max-height: calc(90vh - 100px);
            overflow-y: auto;
        }

        /* Custom scrollbar */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: var(--csgo-darker);
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--csgo-yellow);
            border-radius: 4px;
        }

        /* ============================================
         * LOGIN MODAL - Professional Enhanced Style
         * ============================================ */

        .login-modal {
            width: 420px;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98) 0%, rgba(5, 5, 5, 0.99) 100%);
            border: 1px solid var(--csgo-yellow);
            box-shadow:
                0 0 60px rgba(255, 215, 0, 0.2),
                inset 0 0 100px rgba(255, 215, 0, 0.03);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
        }

        .login-logo::before {
            content: '';
            display: block;
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
            border: 2px solid var(--csgo-yellow);
            border-radius: 50%;
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), inset 0 0 20px rgba(255, 215, 0, 0.1);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), inset 0 0 30px rgba(255, 215, 0, 0.2);
            }
        }

        .login-logo h1 {
            font-family: 'Orbitron', monospace;
            font-size: 36px;
            color: var(--csgo-yellow);
            text-shadow: 0 0 30px var(--csgo-yellow-glow);
            letter-spacing: 8px;
            animation: textGlow 3s ease-in-out infinite;
        }

        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.3); }
        }

        .login-logo p {
            color: var(--csgo-text-dim);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-top: 12px;
            font-weight: 500;
        }

        /* ============================================
         * FORM ELEMENTS - Professional Tactical Style
         * ============================================ */

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--csgo-text-dim);
            font-weight: 500;
        }

        .form-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--csgo-border);
            border-radius: 4px;
            padding: 14px 16px;
            color: var(--csgo-text);
            font-family: 'JetBrains Mono', 'Rajdhani', sans-serif;
            font-size: 15px;
            transition: all var(--transition-normal);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--csgo-yellow);
            box-shadow:
                0 0 0 3px rgba(255, 215, 0, 0.1),
                0 0 20px rgba(255, 215, 0, 0.15);
            background: rgba(0, 0, 0, 0.7);
        }

        .form-input::placeholder {
            color: var(--csgo-text-muted);
            font-style: italic;
        }

        /* ============================================
         * BUTTONS - Professional Tactical Style
         * ============================================ */

        .btn {
            background: linear-gradient(135deg, var(--csgo-yellow) 0%, var(--csgo-yellow-dark) 100%);
            color: var(--csgo-black);
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            box-shadow:
                0 4px 20px rgba(255, 215, 0, 0.4),
                0 0 30px rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--csgo-gray-light) 0%, var(--csgo-gray) 100%);
            color: var(--csgo-text);
            border: 1px solid var(--csgo-border-light);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--csgo-gray-medium) 0%, var(--csgo-gray-light) 100%);
            border-color: var(--csgo-yellow);
            box-shadow:
                0 4px 15px rgba(0, 0, 0, 0.3),
                0 0 10px rgba(255, 215, 0, 0.1);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--csgo-error) 0%, #c62828 100%);
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.2);
        }

        .btn-danger:hover {
            box-shadow:
                0 4px 20px rgba(244, 67, 54, 0.4),
                0 0 30px rgba(244, 67, 54, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--csgo-success) 0%, #388E3C 100%);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
        }

        .btn-primary:hover {
            box-shadow:
                0 4px 20px rgba(76, 175, 80, 0.4),
                0 0 30px rgba(76, 175, 80, 0.2);
        }

        .btn-outline {
            background: transparent;
            color: var(--csgo-text-dim);
            border: 1px solid var(--csgo-border);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--csgo-yellow);
            color: var(--csgo-yellow);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 11px;
        }

        /* ============================================
         * SETUP MODAL - Access Mode Configuration
         * ============================================ */

        .setup-modal {
            width: 600px;
            max-width: 95vw;
            background: linear-gradient(145deg, rgba(20, 20, 20, 0.98) 0%, rgba(5, 5, 5, 0.99) 100%);
            border: 2px solid var(--csgo-yellow);
        }

        .setup-header {
            text-align: center;
            padding: 24px 24px 0;
        }

        .setup-header h2 {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            color: var(--csgo-yellow);
            text-shadow: 0 0 20px var(--csgo-yellow-glow);
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        .setup-header p {
            color: var(--csgo-text-dim);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .setup-section {
            margin-bottom: 24px;
        }

        .setup-section-title {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            color: var(--csgo-yellow);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setup-section-title::before {
            content: '';
            width: 3px;
            height: 14px;
            background: var(--csgo-yellow);
            border-radius: 2px;
        }

        /* Mode Selection Cards */
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .mode-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--csgo-border);
            border-radius: 8px;
            padding: 20px 16px;
            cursor: pointer;
            transition: all var(--transition-normal);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: transparent;
            transition: background var(--transition-normal);
        }

        .mode-card:hover {
            border-color: var(--csgo-yellow);
            background: rgba(255, 215, 0, 0.05);
            transform: translateY(-2px);
        }

        .mode-card.active {
            border-color: var(--csgo-yellow);
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .mode-card.active::before {
            background: var(--csgo-yellow);
        }

        .mode-card.active::after {
            content: '';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 20px;
            height: 20px;
            background: var(--csgo-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mode-icon {
            font-size: 32px;
            margin-bottom: 12px;
            filter: grayscale(0.5);
            transition: filter var(--transition-normal);
        }

        .mode-card:hover .mode-icon,
        .mode-card.active .mode-icon {
            filter: grayscale(0);
        }

        .mode-name {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--csgo-text);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .mode-card.active .mode-name {
            color: var(--csgo-yellow);
        }

        .mode-description {
            font-size: 11px;
            color: var(--csgo-text-dim);
            line-height: 1.4;
        }

        .mode-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 8px;
        }

        .mode-badge.secure {
            background: rgba(76, 175, 80, 0.2);
            color: var(--csgo-success);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .mode-badge.caution {
            background: rgba(255, 152, 0, 0.2);
            color: var(--csgo-warning);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .mode-badge.warning {
            background: rgba(244, 67, 54, 0.2);
            color: var(--csgo-error);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        /* Current Mode Indicator */
        .current-mode-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--csgo-border);
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .current-mode-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: modePulse 2s ease-in-out infinite;
        }

        .current-mode-dot.private {
            background: var(--csgo-success);
            box-shadow: 0 0 10px var(--csgo-success-glow);
        }

        .current-mode-dot.lan {
            background: var(--csgo-warning);
            box-shadow: 0 0 10px var(--csgo-warning-glow);
        }

        .current-mode-dot.public {
            background: var(--csgo-error);
            box-shadow: 0 0 10px var(--csgo-error-glow);
        }

        @keyframes modePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.9); }
        }

        .current-mode-label {
            font-size: 12px;
            color: var(--csgo-text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .current-mode-value {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            color: var(--csgo-yellow);
            font-weight: 600;
        }

        /* Password Status Indicator */
        .password-status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            border-radius: 6px;
            font-size: 13px;
        }

        .password-status-indicator.default {
            background: rgba(244, 67, 54, 0.15);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: var(--csgo-error);
        }

        .password-status-indicator.custom {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: var(--csgo-success);
        }

        .password-status-icon {
            font-size: 18px;
        }

        .password-status-text {
            flex: 1;
        }

        .password-status-text strong {
            display: block;
            font-family: 'Orbitron', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .password-status-text span {
            font-size: 12px;
            opacity: 0.9;
        }

        .btn-reset-default {
            background: transparent;
            border: 1px solid var(--csgo-text-dim);
            color: var(--csgo-text-dim);
            padding: 6px 12px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .btn-reset-default:hover {
            border-color: var(--csgo-warning);
            color: var(--csgo-warning);
            background: rgba(255, 152, 0, 0.1);
        }

        .btn-reset-default:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Password Form in Setup */
        .setup-password-form {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--csgo-border);
            border-radius: 8px;
            padding: 20px;
        }

        .password-strength {
            height: 4px;
            background: var(--csgo-gray);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            border-radius: 2px;
            transition: width 0.3s ease, background 0.3s ease;
        }

        .password-strength-bar.weak {
            width: 33%;
            background: var(--csgo-error);
        }

        .password-strength-bar.medium {
            width: 66%;
            background: var(--csgo-warning);
        }

        .password-strength-bar.strong {
            width: 100%;
            background: var(--csgo-success);
        }

        .password-requirements {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
            font-size: 11px;
        }

        .password-req {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--csgo-text-dim);
        }

        .password-req.met {
            color: var(--csgo-success);
        }

        .password-req-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        /* Setup Actions */
        .setup-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            margin-top: 24px;
        }

        /* Confirmation Dialog */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.98) 0%, rgba(15, 15, 15, 0.99) 100%);
            border: 2px solid var(--csgo-warning);
            border-radius: 8px;
            padding: 24px;
            width: 400px;
            max-width: 90vw;
            z-index: 3000;
            box-shadow: 0 0 40px rgba(255, 152, 0, 0.3);
        }

        .confirm-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2999;
            display: none;
        }

        .confirm-dialog-overlay.active {
            display: block;
        }

        .confirm-dialog-title {
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            color: var(--csgo-warning);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confirm-dialog-message {
            color: var(--csgo-text);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .confirm-dialog-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Login Setup Button */
        .login-setup-btn {
            position: absolute;
            top: 16px;
            right: 16px;
        }

        /* ============================================
         * SECTION PANELS - Inventory Card Style
         * ============================================ */

        .section-panel {
            display: none;
            animation: sectionFadeIn 0.3s ease;
        }

        .section-panel.active {
            display: block;
        }

        @keyframes sectionFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            position: relative;
        }

        .panel-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100px;
            height: 2px;
            background: var(--csgo-yellow);
        }

        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 22px;
            color: var(--csgo-yellow);
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 15px var(--csgo-yellow-glow);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--csgo-yellow);
            border-radius: 2px;
        }

        .panel-actions {
            display: flex;
            gap: 12px;
        }

        /* ============================================
         * DATA CARDS - Professional Card Design
         * ============================================ */

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        .data-card {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.9) 0%, rgba(15, 15, 15, 0.95) 100%);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            transition: all var(--transition-normal);
            position: relative;
            backdrop-filter: blur(5px);
        }

        .data-card:hover {
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 215, 0, 0.1);
            transform: translateY(-4px);
        }

        /* Rarity stripe on left */
        .data-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--csgo-yellow);
        }

        .data-card.rarity-common::before { background: #b0c3d9; }
        .data-card.rarity-uncommon::before { background: #5e98d9; }
        .data-card.rarity-rare::before { background: #4b69ff; }
        .data-card.rarity-mythical::before { background: #8847ff; }
        .data-card.rarity-legendary::before { background: #d32ce6; }
        .data-card.rarity-ancient::before { background: #eb4b4b; }
        .data-card.rarity-contraband::before { background: #e4ae39; }

        .card-header {
            padding: 15px;
            border-bottom: 1px solid var(--csgo-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-weight: 600;
            color: var(--csgo-text);
            font-size: 14px;
        }

        .card-meta {
            font-size: 11px;
            color: var(--csgo-text-dim);
        }

        .card-body {
            padding: 15px;
        }

        .card-content {
            font-size: 13px;
            color: var(--csgo-text-dim);
            line-height: 1.6;
            max-height: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .tag {
            background: var(--csgo-darker);
            border: 1px solid var(--csgo-border);
            padding: 2px 8px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--csgo-yellow);
        }

        .card-footer {
            padding: 10px 15px;
            border-top: 1px solid var(--csgo-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .card-btn {
            background: none;
            border: 1px solid var(--csgo-border);
            color: var(--csgo-text-dim);
            padding: 5px 10px;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .card-btn:hover {
            border-color: var(--csgo-yellow);
            color: var(--csgo-yellow);
        }

        .card-btn.delete:hover {
            border-color: var(--csgo-error);
            color: var(--csgo-error);
        }

        /* ============================================
         * STATS DASHBOARD - Professional Operation Panel
         * ============================================ */

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.9) 0%, rgba(15, 15, 15, 0.95) 100%);
            border: 1px solid rgba(255, 215, 0, 0.15);
            border-radius: 8px;
            padding: 24px 20px;
            text-align: center;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, var(--csgo-yellow) 50%, transparent 100%);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 0%, rgba(255, 215, 0, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .stat-card:hover {
            border-color: rgba(255, 215, 0, 0.4);
            transform: translateY(-5px);
            box-shadow:
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 215, 0, 0.1);
        }

        .stat-card .stat-icon {
            font-size: 28px;
            margin-bottom: 12px;
            color: var(--csgo-yellow);
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.4));
            transition: var(--transition-normal);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.15);
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
        }

        .stat-card .stat-number {
            font-family: 'Orbitron', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--csgo-yellow);
            text-shadow: 0 0 25px var(--csgo-yellow-glow);
            position: relative;
            z-index: 1;
            transition: var(--transition-fast);
        }

        .stat-card:hover .stat-number {
            transform: scale(1.05);
            text-shadow: 0 0 35px var(--csgo-yellow-glow);
        }

        .stat-card .stat-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--csgo-text-dim);
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }

        /* ============================================
         * TABLE - Match History Style
         * ============================================ */

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--csgo-dark);
            border: 1px solid var(--csgo-border);
        }

        .data-table th {
            background: linear-gradient(180deg, var(--csgo-gray) 0%, var(--csgo-dark) 100%);
            padding: 12px 15px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--csgo-yellow);
            border-bottom: 2px solid var(--csgo-yellow);
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--csgo-border);
            font-size: 13px;
        }

        .data-table tr:hover td {
            background: rgba(255, 215, 0, 0.05);
        }

        /* ============================================
         * SEARCH BAR
         * ============================================ */

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            background: var(--csgo-darker);
            border: 1px solid var(--csgo-border);
            border-radius: 2px;
            padding: 10px 15px;
            color: var(--csgo-text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--csgo-yellow);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        /* ============================================
         * LOADING SPINNER - CS:GO Style
         * ============================================ */

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--csgo-border);
            border-top-color: var(--csgo-yellow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 15px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--csgo-text-dim);
        }

        /* ============================================
         * ALERTS & NOTIFICATIONS
         * ============================================ */

        .alert {
            padding: 12px 15px;
            border-radius: 2px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--csgo-success);
            color: var(--csgo-success);
        }

        .alert-error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid var(--csgo-error);
            color: var(--csgo-error);
        }

        .alert-warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid var(--csgo-warning);
            color: var(--csgo-warning);
        }

        /* ============================================
         * TOAST NOTIFICATIONS
         * ============================================ */

        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--csgo-dark);
            border: 1px solid var(--csgo-yellow);
            padding: 15px 20px;
            border-radius: 4px;
            animation: toastSlideIn 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease forwards;
        }

        @keyframes toastSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* ============================================
         * FILE BROWSER - Like CS:GO Workshop
         * ============================================ */

        .file-tree {
            font-family: 'Rajdhani', monospace;
            font-size: 13px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
        }

        .file-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-left-color: var(--csgo-yellow);
        }

        .file-icon {
            margin-right: 10px;
            color: var(--csgo-text-dim);
        }

        .file-name {
            flex: 1;
        }

        .file-size {
            color: var(--csgo-text-dim);
            font-size: 11px;
        }

        /* ============================================
         * CODEBASE SPLIT VIEW - FTP-Style File Manager
         * ============================================ */

        .codebase-split-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 200px);
            min-height: 600px;
        }

        .codebase-top-pane {
            flex: 1;
            min-height: 200px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid var(--csgo-border);
        }

        .codebase-divider {
            height: 8px;
            background: linear-gradient(180deg, var(--csgo-gray) 0%, var(--csgo-dark) 100%);
            cursor: row-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .codebase-divider:hover,
        .codebase-divider.dragging {
            background: var(--csgo-yellow);
        }

        .codebase-divider::before {
            content: '';
            width: 40px;
            height: 2px;
            background: var(--csgo-border);
            border-radius: 1px;
        }

        .codebase-divider:hover::before,
        .codebase-divider.dragging::before {
            background: var(--csgo-black);
        }

        .codebase-bottom-pane {
            flex: 1;
            min-height: 200px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .codebase-file-list {
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }

        .file-browser-list {
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }

        /* Breadcrumb Navigation */
        .file-browser-breadcrumbs {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: var(--csgo-darker);
            border-bottom: 1px solid var(--csgo-border);
            flex-wrap: wrap;
            gap: 5px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .breadcrumb-item {
            color: var(--csgo-text-dim);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .breadcrumb-item:hover {
            color: var(--csgo-yellow);
            background: rgba(255, 215, 0, 0.1);
        }

        .breadcrumb-separator {
            color: var(--csgo-border);
            margin: 0 2px;
        }

        .breadcrumb-item.current {
            color: var(--csgo-yellow);
            font-weight: 600;
        }

        /* File Browser Items */
        .file-browser-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            gap: 10px;
        }

        .file-browser-item:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .file-browser-item.selected {
            background: rgba(255, 215, 0, 0.15);
            border-left-color: var(--csgo-yellow);
        }

        .file-browser-item.in-codebase {
            background: rgba(76, 175, 80, 0.1);
        }

        .file-browser-item.in-codebase::after {
            content: 'INDEXED';
            font-size: 9px;
            padding: 2px 6px;
            background: var(--csgo-success);
            color: var(--csgo-black);
            border-radius: 2px;
            margin-left: auto;
            font-weight: 600;
        }

        .file-browser-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--csgo-yellow);
            cursor: pointer;
        }

        .file-browser-icon {
            font-size: 18px;
            color: var(--csgo-text-dim);
            min-width: 24px;
            text-align: center;
        }

        .file-browser-icon.folder {
            color: var(--csgo-yellow);
        }

        .file-browser-name {
            flex: 1;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
        }

        .file-browser-name.hidden-file {
            color: var(--csgo-text-dim);
        }

        .file-browser-meta {
            display: flex;
            gap: 15px;
            font-size: 11px;
            color: var(--csgo-text-dim);
        }

        .file-browser-size {
            min-width: 70px;
            text-align: right;
        }

        .file-browser-date {
            min-width: 100px;
        }

        /* File Browser Status Bar */
        .file-browser-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 15px;
            background: var(--csgo-gray);
            border-top: 1px solid var(--csgo-border);
            font-size: 12px;
            color: var(--csgo-text-dim);
        }

        /* Parent Directory Item */
        .file-browser-item.parent-dir {
            background: rgba(255, 215, 0, 0.03);
            border-bottom: 1px solid var(--csgo-border);
        }

        .file-browser-item.parent-dir .file-browser-icon {
            color: var(--csgo-warning);
        }

        /* ============================================
         * TEAM MEMBER CARDS - Player Profile Style
         * ============================================ */

        .team-member-card {
            background: linear-gradient(135deg, var(--csgo-gray) 0%, var(--csgo-dark) 100%);
            border: 1px solid var(--csgo-border);
            border-radius: 4px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .team-member-card:hover {
            border-color: var(--csgo-yellow);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .team-member-avatar {
            width: 60px;
            height: 60px;
            background: var(--csgo-darker);
            border: 2px solid var(--csgo-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--csgo-yellow);
        }

        .team-member-info {
            flex: 1;
        }

        .team-member-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--csgo-text);
        }

        .team-member-type {
            font-size: 12px;
            color: var(--csgo-yellow);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .team-member-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--csgo-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-dot.offline {
            background: var(--csgo-error);
            animation: none;
        }

        /* ============================================
         * EMPTY STATE
         * ============================================ */

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--csgo-text-dim);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--csgo-border);
        }

        .empty-state-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--csgo-text);
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* ============================================
         * RESPONSIVE ADJUSTMENTS
         * ============================================ */

        /* Tablet breakpoint */
        @media (max-width: 768px) {
            .nav-panel {
                width: 60px;
            }

            .nav-label {
                display: none;
            }

            .main-content {
                margin-left: 60px;
            }

            .header-stats {
                display: none;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            /* Setup Modal - Responsive for tablets */
            .setup-modal {
                width: 95vw;
                max-height: 90vh;
            }

            .mode-selector {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .mode-card {
                padding: 16px;
            }

            .password-requirements {
                grid-template-columns: 1fr;
            }

            .setup-actions {
                flex-direction: column-reverse;
            }

            .setup-actions .btn {
                width: 100%;
            }
        }

        /* ============================================
         * MOBILE RESPONSIVE - Small Screens (max-width: 480px)
         * ============================================ */

        @media (max-width: 480px) {
            /* Header - Compact for mobile */
            .header {
                height: 50px;
                padding: 0 3vw;
                flex-wrap: nowrap;
            }

            .logo {
                font-size: clamp(12px, 4vw, 18px);
                letter-spacing: 1px;
            }

            .logo span {
                display: none;
            }

            .header-stats {
                display: none;
            }

            .header-actions {
                gap: 2vw;
            }

            .header-actions .btn {
                padding: 8px 12px;
                font-size: 11px;
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Navigation - Bottom bar for mobile */
            .nav-panel {
                position: fixed;
                left: 0;
                right: 0;
                top: auto;
                bottom: 0;
                width: 100%;
                height: auto;
                min-height: 60px;
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                padding: 0;
                border-right: none;
                border-top: 2px solid var(--csgo-yellow);
                background: var(--csgo-dark);
                z-index: 1001;
                -webkit-overflow-scrolling: touch;
            }

            .nav-item {
                flex: 0 0 auto;
                min-width: 60px;
                min-height: 60px;
                padding: 8px 12px;
                border-left: none;
                border-top: 3px solid transparent;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .nav-item:hover,
            .nav-item.active {
                border-left: none;
                border-top-color: var(--csgo-yellow);
            }

            .nav-item.active::after {
                display: none;
            }

            .nav-icon {
                font-size: 20px;
                margin-bottom: 2px;
            }

            .nav-label {
                display: block;
                font-size: 8px;
            }

            /* Main content - Full width on mobile */
            .main-content {
                margin-left: 0;
                margin-top: 50px;
                margin-bottom: 70px;
                padding: 3vw;
                min-height: calc(100vh - 120px);
                width: 100%;
            }

            /* Panel headers */
            .panel-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
                padding-bottom: 10px;
                margin-bottom: 15px;
            }

            .panel-title {
                font-size: clamp(14px, 5vw, 20px);
                letter-spacing: 1px;
            }

            .panel-actions {
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .panel-actions .btn {
                flex: 1;
                min-width: 80px;
                min-height: 44px;
                padding: 10px 8px;
                font-size: 11px;
            }

            /* Search bar */
            .search-bar {
                flex-direction: column;
                gap: 8px;
            }

            .search-input {
                width: 100%;
                min-height: 44px;
                font-size: 16px; /* Prevents iOS zoom */
            }

            .search-bar .btn {
                width: 100%;
                min-height: 44px;
            }

            /* Stats grid */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 12px 8px;
            }

            .stat-card .stat-icon {
                font-size: 20px;
                margin-bottom: 5px;
            }

            .stat-card .stat-number {
                font-size: clamp(18px, 6vw, 28px);
            }

            .stat-card .stat-title {
                font-size: 9px;
                letter-spacing: 1px;
            }

            /* Card grid */
            .card-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .data-card {
                margin-bottom: 0;
            }

            .card-header {
                padding: 10px 12px;
                flex-wrap: wrap;
                gap: 5px;
            }

            .card-title {
                font-size: 13px;
            }

            .card-meta {
                font-size: 10px;
            }

            .card-body {
                padding: 10px 12px;
            }

            .card-content {
                font-size: 12px;
                max-height: 80px;
            }

            .card-footer {
                padding: 8px 12px;
                flex-wrap: wrap;
                gap: 8px;
            }

            .card-btn {
                min-height: 44px;
                min-width: 44px;
                padding: 8px 12px;
                font-size: 11px;
                flex: 1;
                text-align: center;
            }

            /* Modals - Full screen on mobile */
            .modal-overlay {
                padding: 0;
                align-items: flex-start;
            }

            .modal {
                width: 100vw;
                max-width: 100vw;
                min-height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                border: none;
                border-top: 2px solid var(--csgo-yellow);
            }

            .modal::before,
            .modal::after {
                display: none;
            }

            .modal-header {
                padding: 12px 15px;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .modal-title {
                font-size: 14px;
                letter-spacing: 1px;
            }

            .modal-close {
                font-size: 28px;
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .modal-body {
                padding: 15px;
                max-height: calc(100vh - 60px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Login modal */
            .login-modal {
                width: 100vw;
                max-width: 100vw;
            }

            .login-logo h1 {
                font-size: clamp(20px, 7vw, 28px);
                letter-spacing: 2px;
            }

            .login-logo p {
                font-size: 10px;
                letter-spacing: 2px;
            }

            .login-form {
                gap: 15px;
            }

            .form-group {
                gap: 6px;
            }

            .form-label {
                font-size: 11px;
            }

            .form-input {
                min-height: 48px;
                padding: 12px;
                font-size: 16px; /* Prevents iOS zoom */
            }

            .login-form .btn {
                min-height: 48px;
                font-size: 13px;
            }

            /* Tables - Horizontal scroll */
            .data-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
                font-size: 11px;
                white-space: nowrap;
            }

            /* TeamMember cards */
            .team-member-card {
                padding: 12px;
                gap: 10px;
            }

            .team-member-avatar {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .team-member-name {
                font-size: 14px;
            }

            .team-member-type {
                font-size: 10px;
            }

            /* File tree */
            .file-item {
                padding: 10px 12px;
                min-height: 44px;
            }

            .file-name {
                font-size: 12px;
                word-break: break-all;
            }

            .file-size {
                font-size: 10px;
            }

            /* Toast */
            .toast-container {
                left: 3vw;
                right: 3vw;
                bottom: 75px;
            }

            .toast {
                padding: 12px 15px;
                font-size: 13px;
            }

            /* Empty state */
            .empty-state {
                padding: 30px 15px;
            }

            .empty-state-icon {
                font-size: 40px;
            }

            .empty-state-title {
                font-size: 14px;
            }

            .empty-state-text {
                font-size: 12px;
            }

            /* Loading */
            .loading {
                padding: 30px 15px;
            }

            .spinner {
                width: 40px;
                height: 40px;
            }

            .loading-text {
                font-size: 11px;
            }

            /* Alerts */
            .alert {
                padding: 10px 12px;
                font-size: 12px;
            }

            /* Tags */
            .tag {
                padding: 3px 6px;
                font-size: 9px;
            }

            /* Config section */
            #configSection .card-grid {
                gap: 15px;
            }

            #configSection .form-group {
                margin-bottom: 12px !important;
            }

            #configSection .btn {
                width: 100%;
                min-height: 44px;
            }

            /* Setup Modal - Mobile optimizations */
            .setup-modal {
                width: 100vw;
                max-width: 100vw;
                max-height: 100vh;
            }

            .setup-header {
                padding: 16px 16px 0;
            }

            .setup-header h2 {
                font-size: 18px;
                letter-spacing: 2px;
            }

            .setup-header p {
                font-size: 10px;
            }

            .setup-section-title {
                font-size: 12px;
            }

            .mode-selector {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .mode-card {
                padding: 14px;
                display: flex;
                flex-direction: row;
                align-items: center;
                text-align: left;
                gap: 12px;
            }

            .mode-icon {
                font-size: 24px;
                margin-bottom: 0;
            }

            .mode-card-content {
                flex: 1;
            }

            .mode-name {
                font-size: 12px;
                margin-bottom: 4px;
            }

            .mode-description {
                font-size: 10px;
            }

            .mode-badge {
                font-size: 8px;
                padding: 2px 6px;
            }

            .current-mode-indicator {
                padding: 10px 16px;
                gap: 8px;
            }

            .current-mode-label,
            .current-mode-value {
                font-size: 11px;
            }

            .setup-password-form {
                padding: 16px;
            }

            .password-requirements {
                grid-template-columns: 1fr;
                gap: 6px;
                font-size: 10px;
            }

            .setup-actions {
                flex-direction: column-reverse;
                gap: 10px;
                padding-top: 16px;
            }

            .setup-actions .btn {
                width: 100%;
                min-height: 48px;
            }

            .login-setup-btn {
                top: 12px;
                right: 12px;
                padding: 6px 12px;
                font-size: 10px;
            }

            /* Confirmation dialog - mobile */
            .confirm-dialog {
                width: 95vw;
                padding: 20px;
            }

            .confirm-dialog-title {
                font-size: 14px;
            }

            .confirm-dialog-message {
                font-size: 13px;
            }

            .confirm-dialog-actions {
                flex-direction: column-reverse;
                gap: 10px;
            }

            .confirm-dialog-actions .btn {
                width: 100%;
                min-height: 44px;
            }
        }

        /* ============================================
         * EXTRA SMALL SCREENS - 350x370 and below
         * ============================================ */

        @media (max-width: 400px) and (max-height: 450px) {
            /* Ultra compact header */
            .header {
                height: 44px;
                padding: 0 2vw;
            }

            .logo {
                font-size: 11px;
            }

            /* Even more compact nav */
            .nav-panel {
                min-height: 52px;
            }

            .nav-item {
                min-width: 50px;
                min-height: 52px;
                padding: 6px 8px;
            }

            .nav-icon {
                font-size: 16px;
            }

            .nav-label {
                font-size: 7px;
            }

            /* Main content adjustments */
            .main-content {
                margin-top: 44px;
                margin-bottom: 60px;
                padding: 2vw;
            }

            .panel-title {
                font-size: 12px;
            }

            /* Stats grid - single column */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .stat-card {
                padding: 8px 6px;
            }

            .stat-card .stat-icon {
                font-size: 16px;
                margin-bottom: 3px;
            }

            .stat-card .stat-number {
                font-size: 16px;
            }

            .stat-card .stat-title {
                font-size: 8px;
                margin-top: 4px;
            }

            /* Compact cards */
            .card-header {
                padding: 8px 10px;
            }

            .card-body {
                padding: 8px 10px;
            }

            .card-content {
                max-height: 60px;
                font-size: 11px;
            }

            .card-footer {
                padding: 6px 10px;
            }

            /* Login adjustments */
            .login-logo {
                margin-bottom: 15px;
            }

            .login-logo h1 {
                font-size: 18px;
            }

            .login-logo p {
                font-size: 9px;
                margin-top: 5px;
            }

            .modal-body {
                padding: 12px;
            }

            /* Search compact */
            .search-bar {
                gap: 6px;
            }

            .search-input,
            .search-bar .btn {
                min-height: 40px;
            }

            /* Touch target enforcement */
            .btn,
            .card-btn,
            .nav-item,
            .file-item {
                min-height: 44px;
            }
        }

        /* ============================================
         * LANDSCAPE MODE ON SMALL SCREENS
         * ============================================ */

        @media (max-width: 700px) and (orientation: landscape) {
            .header {
                height: 40px;
            }

            .nav-panel {
                position: fixed;
                left: 0;
                top: 40px;
                bottom: 0;
                width: 50px;
                height: auto;
                flex-direction: column;
                border-top: none;
                border-right: 1px solid var(--csgo-border);
                overflow-y: auto;
            }

            .nav-item {
                min-width: unset;
                min-height: 44px;
                border-top: none;
                border-left: 3px solid transparent;
            }

            .nav-item:hover,
            .nav-item.active {
                border-top: none;
                border-left-color: var(--csgo-yellow);
            }

            .nav-label {
                display: none;
            }

            .main-content {
                margin-left: 50px;
                margin-top: 40px;
                margin-bottom: 0;
            }

            /* Modals in landscape */
            .modal {
                min-height: 100vh;
                max-height: 100vh;
            }

            .modal-body {
                max-height: calc(100vh - 50px);
            }
        }

        /* ============================================
         * TOUCH DEVICE OPTIMIZATIONS
         * ============================================ */

        @media (hover: none) and (pointer: coarse) {
            /* Remove hover effects that don't work on touch */
            .btn:hover::before {
                display: none;
            }

            .data-card:hover {
                transform: none;
            }

            .stat-card:hover {
                transform: none;
            }

            /* Add active states for touch feedback */
            .btn:active {
                transform: scale(0.98);
                opacity: 0.9;
            }

            .nav-item:active {
                background: rgba(255, 215, 0, 0.2);
            }

            .card-btn:active {
                background: rgba(255, 215, 0, 0.2);
            }

            /* Ensure tap targets */
            .btn,
            .card-btn,
            .nav-item,
            .file-item,
            .modal-close,
            input[type="text"],
            input[type="password"] {
                min-height: 44px;
            }
        }

        /* ============================================
         * SAFE AREA INSETS (notch handling)
         * ============================================ */

        @supports (padding: max(0px)) {
            .header {
                padding-left: max(3vw, env(safe-area-inset-left));
                padding-right: max(3vw, env(safe-area-inset-right));
            }

            .nav-panel {
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }

            .main-content {
                padding-left: max(3vw, env(safe-area-inset-left));
                padding-right: max(3vw, env(safe-area-inset-right));
            }

            .toast-container {
                bottom: max(75px, calc(70px + env(safe-area-inset-bottom)));
            }
        }

        /* ============================================
         * HIGH CONTRAST / ACCESSIBILITY
         * ============================================ */

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ============================================
         * DYNAMIC CSS CUSTOM PROPERTIES (JS-powered)
         * ============================================ */

        :root {
            --vh: 1vh;
            --screen-width: 100vw;
            --screen-height: 100vh;
            --safe-vh: 1vh;
        }

        /* Use --vh for elements that need accurate viewport height on mobile */
        .modal {
            min-height: calc(var(--vh, 1vh) * 100);
        }

        /* ============================================
         * BODY STATE CLASSES (set by JavaScript)
         * ============================================ */

        body.is-mobile .header-stats {
            display: none !important;
        }

        body.is-mobile .logo span {
            display: none !important;
        }

        body.is-small-screen .nav-label {
            font-size: 6px !important;
        }

        body.is-touch .btn {
            -webkit-tap-highlight-color: rgba(255, 215, 0, 0.3);
        }

        body.is-touch .nav-item {
            -webkit-tap-highlight-color: rgba(255, 215, 0, 0.3);
        }

        /* Touch feedback class */
        .nav-item.touching {
            background: rgba(255, 215, 0, 0.25) !important;
            border-color: var(--csgo-yellow) !important;
        }

        /* Prevent horizontal overflow on body */
        html, body {
            max-width: 100vw;
            overflow-x: hidden;
        }

        /* ============================================
         * ADDITIONAL MOBILE FIXES
         * ============================================ */

        /* Fix for iOS input zoom */
        @media screen and (max-width: 480px) {
            input[type="text"],
            input[type="password"],
            input[type="email"],
            input[type="number"],
            select,
            textarea {
                font-size: 16px !important;
            }
        }

        /* Ensure smooth scrolling on all scrollable elements */
        * {
            -webkit-overflow-scrolling: touch;
        }

        /* Hide scrollbars on mobile but keep functionality */
        @media (max-width: 480px) {
            .nav-panel::-webkit-scrollbar,
            .modal-body::-webkit-scrollbar {
                width: 4px;
                height: 4px;
            }

            .nav-panel::-webkit-scrollbar-thumb,
            .modal-body::-webkit-scrollbar-thumb {
                background: var(--csgo-yellow-dark);
            }
        }
    </style>
    <script src="/shared-logger.js"></script>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Modal Overlay -->
    <div class="modal-overlay active" id="loginOverlay">
        <div class="modal login-modal">
            <!-- Setup Button -->
            <button class="btn btn-outline btn-sm login-setup-btn" onclick="openSetupModal()" title="Server Setup">
                &#9881; SETUP
            </button>
            <div class="modal-body">
                <div class="login-logo">
                    <h1>SPECMEM</h1>
                    <p>Tactical Memory Operations</p>
                </div>
                <!-- Current Mode Indicator on Login -->
                <div class="current-mode-indicator" id="loginModeIndicator">
                    <span class="current-mode-dot private" id="loginModeDot"></span>
                    <span class="current-mode-label">Access Mode:</span>
                    <span class="current-mode-value" id="loginModeValue">PRIVATE</span>
                </div>
                <form class="login-form" id="loginForm">
                    <div id="loginError" class="alert alert-error" style="display: none;"></div>
                    <div class="form-group">
                        <label class="form-label">Access Code</label>
                        <input type="password" class="form-input" id="passwordInput" placeholder="Enter access code..." autofocus>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        AUTHORIZE ACCESS
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Setup Modal Overlay -->
    <div class="modal-overlay" id="setupOverlay">
        <div class="modal setup-modal">
            <div class="modal-header">
                <span class="modal-title">SERVER SETUP</span>
                <button class="modal-close" onclick="closeSetupModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setup-header">
                    <h2>ACCESS CONFIGURATION</h2>
                    <p>Configure server access mode and security settings</p>
                </div>

                <!-- Current Mode Display -->
                <div class="current-mode-indicator" id="setupCurrentMode">
                    <span class="current-mode-dot private" id="setupModeDot"></span>
                    <span class="current-mode-label">Current Mode:</span>
                    <span class="current-mode-value" id="setupModeValue">PRIVATE</span>
                </div>

                <!-- Mode Selection Section -->
                <div class="setup-section">
                    <div class="setup-section-title">Access Mode</div>
                    <div class="mode-selector">
                        <!-- Private Mode -->
                        <div class="mode-card active" data-mode="private" onclick="selectMode('private')">
                            <div class="mode-icon">&#128274;</div>
                            <div class="mode-name">Private</div>
                            <div class="mode-description">Localhost only. Maximum security for personal use.</div>
                            <span class="mode-badge secure">SECURE</span>
                        </div>
                        <!-- LAN Mode -->
                        <div class="mode-card" data-mode="lan" onclick="selectMode('lan')">
                            <div class="mode-icon">&#127760;</div>
                            <div class="mode-name">LAN Only</div>
                            <div class="mode-description">Local network access. Share within your home/office.</div>
                            <span class="mode-badge caution">CAUTION</span>
                        </div>
                        <!-- Public Mode -->
                        <div class="mode-card" data-mode="public" onclick="selectMode('public')">
                            <div class="mode-icon">&#127758;</div>
                            <div class="mode-name">Public</div>
                            <div class="mode-description">Internet accessible. Requires strong password.</div>
                            <span class="mode-badge warning">WARNING</span>
                        </div>
                    </div>
                </div>

                <!-- Password Change Section -->
                <div class="setup-section">
                    <div class="setup-section-title">Change Password</div>

                    <!-- Password Status Indicator -->
                    <div class="password-status-indicator default" id="passwordStatusIndicator">
                        <span class="password-status-icon" id="passwordStatusIcon">&#9888;</span>
                        <div class="password-status-text">
                            <strong id="passwordStatusTitle">DEFAULT PASSWORD</strong>
                            <span id="passwordStatusMessage">Using default password - please change for security</span>
                        </div>
                        <button type="button" class="btn-reset-default" id="resetToDefaultBtn" onclick="resetToDefaultPassword()" style="display: none;">
                            Reset to Default
                        </button>
                    </div>

                    <div class="setup-password-form">
                        <form id="setupPasswordForm">
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-input" id="setupCurrentPassword" placeholder="Enter current password">
                            </div>
                            <div class="form-group" style="margin-bottom: 8px;">
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-input" id="setupNewPassword" placeholder="Enter new password" oninput="updatePasswordStrength()">
                                <div class="password-strength">
                                    <div class="password-strength-bar" id="passwordStrengthBar"></div>
                                </div>
                            </div>
                            <div class="password-requirements" id="passwordRequirements">
                                <div class="password-req" id="reqLength">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>8+ characters</span>
                                </div>
                                <div class="password-req" id="reqLower">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>Lowercase letter</span>
                                </div>
                                <div class="password-req" id="reqUpper">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>Uppercase letter</span>
                                </div>
                                <div class="password-req" id="reqNumber">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>Number</span>
                                </div>
                                <div class="password-req" id="reqSpecial">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>Special character</span>
                                </div>
                                <div class="password-req" id="reqMatch">
                                    <span class="password-req-icon">&#10005;</span>
                                    <span>Passwords match</span>
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 16px; margin-bottom: 16px;">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" class="form-input" id="setupConfirmPassword" placeholder="Confirm new password" oninput="updatePasswordStrength()">
                            </div>
                            <button type="submit" class="btn" style="width: 100%;" id="updatePasswordBtn" disabled>
                                UPDATE PASSWORD
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Setup Actions -->
                <div class="setup-actions">
                    <button class="btn btn-secondary" onclick="closeSetupModal()">CANCEL</button>
                    <button class="btn" onclick="applyModeChange()" id="applyModeBtn" style="display: none;">
                        APPLY MODE CHANGE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mode Change Confirmation Dialog -->
    <div class="confirm-dialog-overlay" id="modeConfirmOverlay">
        <div class="confirm-dialog" id="modeConfirmDialog">
            <div class="confirm-dialog-title">
                <span>&#9888;</span>
                <span>CONFIRM MODE CHANGE</span>
            </div>
            <div class="confirm-dialog-message" id="modeConfirmMessage">
                Are you sure you want to change the access mode?
            </div>
            <div class="confirm-dialog-actions">
                <button class="btn btn-secondary" onclick="cancelModeChange()">CANCEL</button>
                <button class="btn btn-danger" onclick="confirmModeChange()" id="confirmModeBtn">CONFIRM</button>
            </div>
        </div>
    </div>

    <!-- Memory Viewer Modal -->
    <div class="modal-overlay" id="memoryViewerOverlay">
        <div class="modal" style="width: 700px; max-width: 95vw;">
            <div class="modal-header">
                <span class="modal-title">MEMORY DETAILS</span>
                <button class="modal-close" onclick="closeMemoryViewer()">&times;</button>
            </div>
            <div class="modal-body" id="memoryViewerContent">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading memory...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Viewer Modal -->
    <div class="modal-overlay" id="sessionViewerOverlay">
        <div class="modal" style="width: 900px; max-width: 95vw;">
            <div class="modal-header">
                <span class="modal-title">SESSION DETAILS</span>
                <button class="modal-close" onclick="closeSessionViewer()">&times;</button>
            </div>
            <div class="modal-body" id="sessionViewerContent" style="max-height: 70vh; overflow-y: auto;">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading session...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Skill Editor Modal -->
    <div class="modal-overlay" id="skillEditorOverlay">
        <div class="modal" style="width: 900px; max-width: 95vw;">
            <div class="modal-header">
                <span class="modal-title">SKILL EDITOR</span>
                <button class="modal-close" onclick="closeSkillEditor()">&times;</button>
            </div>
            <div class="modal-body" id="skillEditorContent" style="max-height: 70vh; overflow-y: auto;">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading skill...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Viewer Modal -->
    <div class="modal-overlay" id="fileViewerOverlay">
        <div class="modal" style="width: 900px; max-width: 95vw;">
            <div class="modal-header">
                <span class="modal-title">FILE VIEWER</span>
                <button class="modal-close" onclick="closeFileViewer()">&times;</button>
            </div>
            <div class="modal-body" id="fileViewerContent" style="max-height: 70vh; overflow-y: auto;">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading file...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (hidden until logged in) -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo">SPECMEM <span>// TACTICAL OPS</span></div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="headerMemories">0</span>
                    <span class="stat-label">Memories</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="headerSessions">0</span>
                    <span class="stat-label">Sessions</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="headerFiles">0</span>
                    <span class="stat-label">Files</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="headerTeamMembers">0</span>
                    <span class="stat-label">TeamMembers</span>
                </div>
            </div>
            <div id="language-selector-container"></div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="logout()">LOGOUT</button>
            </div>
        </header>

        <!-- Language Selector Component -->
        <script src="/shared-language-selector.js"></script>

        <!-- Navigation Panel -->
        <nav class="nav-panel">
            <div class="nav-item active" data-section="stats" data-tooltip="Dashboard Stats" onclick="showSection('stats')">
                <span class="nav-icon">&#128202;</span>
                <span class="nav-label">Stats</span>
            </div>
            <div class="nav-item" data-section="memories" data-tooltip="Memory Bank" onclick="showSection('memories')">
                <span class="nav-icon">&#128293;</span>
                <span class="nav-label">Memory</span>
            </div>
            <div class="nav-item" data-section="sessions" data-tooltip="Claude Sessions" onclick="showSection('sessions')">
                <span class="nav-icon">&#128172;</span>
                <span class="nav-label">Sessions</span>
            </div>
            <div class="nav-item" data-section="codebase" data-tooltip="Codebase Browser" onclick="showSection('codebase')">
                <span class="nav-icon">&#128193;</span>
                <span class="nav-label">Codebase</span>
            </div>
            <div class="nav-item" data-section="skills" data-tooltip="Skills Arsenal" onclick="showSection('skills')">
                <span class="nav-icon">&#9889;</span>
                <span class="nav-label">Skills</span>
            </div>
            <a href="/team-members.html" class="nav-item" data-tooltip="TeamMember Coordination" style="text-decoration: none;">
                <span class="nav-icon">&#128101;</span>
                <span class="nav-label">TeamMembers</span>
            </a>
            <a href="/team-member-history.html" class="nav-item" data-tooltip="Team Member History" style="text-decoration: none;">
                <span class="nav-icon">&#128220;</span>
                <span class="nav-label">History</span>
            </a>
            <a href="/memory-recall.html" class="nav-item" data-tooltip="Memory Recall" style="text-decoration: none;">
                <span class="nav-icon">&#128270;</span>
                <span class="nav-label">Recall</span>
            </a>
            <div class="nav-item" data-section="config" data-tooltip="Configuration" onclick="showSection('config')">
                <span class="nav-icon">&#9881;</span>
                <span class="nav-label">Config</span>
            </div>
            <a href="/memory-controls.html" class="nav-item" data-tooltip="Memory Controls" style="text-decoration: none;">
                <span class="nav-icon">&#128200;</span>
                <span class="nav-label">Mem Ctrl</span>
            </a>
            <a href="/prompt-console.html" class="nav-item" data-tooltip="Prompt Console" style="text-decoration: none;">
                <span class="nav-icon">&#128187;</span>
                <span class="nav-label">Console</span>
            </a>
            <a href="/codebase-config.html" class="nav-item" data-tooltip="Language Manager" style="text-decoration: none;">
                <span class="nav-icon">&#128736;</span>
                <span class="nav-label">Languages</span>
            </a>
            <a href="/file-explorer.html" class="nav-item" data-tooltip="File Explorer - Manage Watched Paths" style="text-decoration: none;">
                <span class="nav-icon">&#128193;</span>
                <span class="nav-label">Files</span>
            </a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Stats Section -->
            <section class="section-panel active" id="statsSection">
                <div class="panel-header">
                    <h2 class="panel-title">Operation Status</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">&#128293;</div>
                        <div class="stat-number" id="statMemories">0</div>
                        <div class="stat-title">Total Memories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">&#128172;</div>
                        <div class="stat-number" id="statSessions">0</div>
                        <div class="stat-title">Claude Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">&#128193;</div>
                        <div class="stat-number" id="statFiles">0</div>
                        <div class="stat-title">Indexed Files</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">&#9889;</div>
                        <div class="stat-number" id="statSkills">0</div>
                        <div class="stat-title">Active Skills</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">&#128101;</div>
                        <div class="stat-number" id="statTeamMembers">0</div>
                        <div class="stat-title">Active Team Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">&#9201;</div>
                        <div class="stat-number" id="statUptime">0h</div>
                        <div class="stat-title">Uptime</div>
                    </div>
                </div>
            </section>

            <!-- Memories Section -->
            <section class="section-panel" id="memoriesSection">
                <div class="panel-header">
                    <h2 class="panel-title">Memory Bank</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" onclick="loadMemories()">Refresh</button>
                    </div>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="memorySearch" placeholder="Search memories...">
                    <button class="btn" onclick="searchMemories()">Search</button>
                </div>
                <div id="memoriesContainer" class="card-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading memories...</div>
                    </div>
                </div>
            </section>

            <!-- Sessions Section -->
            <section class="section-panel" id="sessionsSection">
                <div class="panel-header">
                    <h2 class="panel-title">Claude Sessions</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" onclick="loadSessions()">Refresh</button>
                    </div>
                </div>
                <div id="sessionsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading sessions...</div>
                    </div>
                </div>
            </section>

            <!-- Codebase Section - Split View with File Browser -->
            <section class="section-panel" id="codebaseSection">
                <!-- TOP HALF: Indexed Codebase Files -->
                <div class="codebase-split-container">
                    <div class="codebase-top-pane" id="codebaseTopPane">
                        <div class="panel-header">
                            <h2 class="panel-title">Indexed Codebase Files</h2>
                            <div class="panel-actions">
                                <button class="btn btn-secondary" onclick="loadCodebase()">Refresh</button>
                            </div>
                        </div>
                        <div class="search-bar">
                            <input type="text" class="search-input" id="codebaseSearch" placeholder="Search indexed files...">
                            <button class="btn" onclick="searchCodebase()">Search</button>
                        </div>
                        <div id="codebaseContainer" class="codebase-file-list">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div class="loading-text">Loading codebase...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Resize Handle -->
                    <div class="codebase-divider" id="codebaseDivider"></div>

                    <!-- BOTTOM HALF: File System Browser -->
                    <div class="codebase-bottom-pane" id="codebaseBottomPane">
                        <div class="panel-header">
                            <h2 class="panel-title">File System Browser</h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" id="addToCodebaseBtn" onclick="addSelectedToCodebase()" disabled>Add Selected</button>
                                <button class="btn" id="removeFromCodebaseBtn" onclick="removeSelectedFromCodebase()" disabled>Remove Selected</button>
                            </div>
                        </div>

                        <!-- Breadcrumb Navigation -->
                        <div class="file-browser-breadcrumbs" id="fileBrowserBreadcrumbs">
                            <span class="breadcrumb-item" onclick="browsePath('/')">/</span>
                        </div>

                        <!-- Search/Filter Bar -->
                        <div class="search-bar">
                            <input type="text" class="search-input" id="fileBrowserSearch" placeholder="Filter files in current directory..." oninput="filterFileBrowser(this.value)">
                        </div>

                        <!-- File Browser List -->
                        <div id="fileBrowserContainer" class="file-browser-list">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div class="loading-text">Loading files...</div>
                            </div>
                        </div>

                        <!-- Selected Items Status -->
                        <div class="file-browser-status" id="fileBrowserStatus">
                            <span id="selectedCount">0 items selected</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Skills Section -->
            <section class="section-panel" id="skillsSection">
                <div class="panel-header">
                    <h2 class="panel-title">Skills Arsenal</h2>
                    <div class="panel-actions">
                        <button class="btn" onclick="reloadSkills()">Reload All</button>
                        <button class="btn btn-secondary" onclick="loadSkills()">Refresh</button>
                    </div>
                </div>
                <div id="skillsContainer" class="card-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading skills...</div>
                    </div>
                </div>
            </section>

            <!-- TeamMembers Section -->
            <section class="section-panel" id="teamMembersSection">
                <div class="panel-header">
                    <h2 class="panel-title">TeamMember Coordination</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" onclick="loadTeamMembers()">Refresh</button>
                    </div>
                </div>
                <div id="teamMembersContainer" class="card-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading team members...</div>
                    </div>
                </div>
            </section>

            <!-- Config Section -->
            <section class="section-panel" id="configSection">
                <div class="panel-header">
                    <h2 class="panel-title">Configuration</h2>
                </div>
                <div class="card-grid">
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-title">Change Password</span>
                        </div>
                        <div class="card-body">
                            <form id="changePasswordForm">
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label class="form-label">Current Password</label>
                                    <input type="password" class="form-input" id="currentPassword">
                                </div>
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label class="form-label">New Password</label>
                                    <input type="password" class="form-input" id="newPassword">
                                </div>
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-input" id="confirmPassword">
                                </div>
                                <button type="submit" class="btn">Update Password</button>
                            </form>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-title">Server Info</span>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 10px;">
                                <span class="form-label">Coordination Port:</span>
                                <span id="configCoordPort">8588</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <span class="form-label">Dashboard Port:</span>
                                <span id="configDashPort">8589</span>
                            </div>
                            <div>
                                <span class="form-label">WebSocket:</span>
                                <span id="configWsStatus">Disconnected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // ============================================
        // SPECMEM Dashboard - JavaScript
        // ============================================

        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        // ==================== AUTHENTICATION ====================

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (response.ok) {
                    errorDiv.style.display = 'none';
                    document.getElementById('loginOverlay').classList.remove('active');
                    document.getElementById('mainApp').style.display = 'block';
                    initializeApp();
                } else {
                    errorDiv.textContent = data.error || 'Authentication failed';
                    errorDiv.style.display = 'block';
                    document.getElementById('passwordInput').value = '';
                }
            } catch (error) {
                errorDiv.textContent = 'Connection error. Please try again.';
                errorDiv.style.display = 'block';
            }
        });

        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/auth/status');
                const data = await response.json();

                if (data.authenticated) {
                    document.getElementById('loginOverlay').classList.remove('active');
                    document.getElementById('mainApp').style.display = 'block';
                    initializeApp();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                serverLog('error', 'Auth check failed', { error: error.message });
            }
        }

        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                location.reload();
            } catch (error) {
                showToast('Logout failed', 'error');
            }
        }

        // ==================== SETUP MODAL ====================

        // Setup state
        let currentAccessMode = 'private';
        let selectedMode = 'private';
        let pendingModeChange = null;

        // Load current access mode on page load
        async function loadAccessMode() {
            try {
                const response = await fetch('/api/settings/access-mode');
                if (response.ok) {
                    const data = await response.json();
                    currentAccessMode = data.mode || 'private';
                    selectedMode = currentAccessMode;
                    updateModeIndicators(currentAccessMode);
                }
            } catch (error) {
                console.error('Failed to load access mode:', error);
                // Default to private if cannot load
                currentAccessMode = 'private';
                selectedMode = 'private';
                updateModeIndicators('private');
            }
        }

        // Update all mode indicators
        function updateModeIndicators(mode) {
            const modeName = mode.toUpperCase();

            // Login page indicator
            const loginDot = document.getElementById('loginModeDot');
            const loginValue = document.getElementById('loginModeValue');
            if (loginDot) {
                loginDot.className = 'current-mode-dot ' + mode;
            }
            if (loginValue) {
                loginValue.textContent = modeName;
            }

            // Setup modal indicator
            const setupDot = document.getElementById('setupModeDot');
            const setupValue = document.getElementById('setupModeValue');
            if (setupDot) {
                setupDot.className = 'current-mode-dot ' + mode;
            }
            if (setupValue) {
                setupValue.textContent = modeName;
            }

            // Update mode cards
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.mode === mode) {
                    card.classList.add('active');
                }
            });
        }

        // Open setup modal
        function openSetupModal() {
            document.getElementById('setupOverlay').classList.add('active');
            loadAccessMode();
            loadPasswordStatus();
            resetPasswordForm();
        }

        // Load password status
        async function loadPasswordStatus() {
            try {
                const response = await fetch('/api/settings/password/status');
                const data = await response.json();

                if (data.success) {
                    updatePasswordStatusIndicator(data.passwordStatus);
                }
            } catch (error) {
                console.error('Error loading password status:', error);
            }
        }

        // Update password status indicator UI
        function updatePasswordStatusIndicator(status) {
            const indicator = document.getElementById('passwordStatusIndicator');
            const icon = document.getElementById('passwordStatusIcon');
            const title = document.getElementById('passwordStatusTitle');
            const message = document.getElementById('passwordStatusMessage');
            const resetBtn = document.getElementById('resetToDefaultBtn');

            if (status.isDefault) {
                indicator.className = 'password-status-indicator default';
                icon.innerHTML = '&#9888;'; // Warning sign
                title.textContent = 'DEFAULT PASSWORD';
                message.textContent = 'Using default password - please change for security';
                resetBtn.style.display = 'none';
            } else {
                indicator.className = 'password-status-indicator custom';
                icon.innerHTML = '&#10004;'; // Checkmark
                title.textContent = 'CUSTOM PASSWORD';
                message.textContent = 'Password configured from ' + status.source;
                resetBtn.style.display = 'block';
            }
        }

        // Reset to default password
        async function resetToDefaultPassword() {
            const currentPassword = prompt('Enter your current password to reset to default:');
            if (!currentPassword) return;

            const confirmReset = confirm('Are you sure you want to reset to the default password?\n\nWARNING: The default password is publicly known and insecure.\nOnly do this for troubleshooting purposes.');
            if (!confirmReset) return;

            const resetBtn = document.getElementById('resetToDefaultBtn');
            resetBtn.disabled = true;
            resetBtn.textContent = 'Resetting...';

            try {
                const response = await fetch('/api/settings/password/reset-to-default', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentPassword })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showToast('Password reset to default successfully', 'success');
                    loadPasswordStatus();
                } else {
                    showToast(data.error || 'Failed to reset password', 'error');
                }
            } catch (error) {
                console.error('Reset password error:', error);
                showToast('Failed to reset password', 'error');
            } finally {
                resetBtn.disabled = false;
                resetBtn.textContent = 'Reset to Default';
            }
        }

        // Close setup modal
        function closeSetupModal() {
            document.getElementById('setupOverlay').classList.remove('active');
            selectedMode = currentAccessMode;
            updateModeIndicators(currentAccessMode);
            document.getElementById('applyModeBtn').style.display = 'none';
            resetPasswordForm();
        }

        // Select access mode
        function selectMode(mode) {
            selectedMode = mode;

            // Update visual selection
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.mode === mode) {
                    card.classList.add('active');
                }
            });

            // Show/hide apply button
            const applyBtn = document.getElementById('applyModeBtn');
            if (mode !== currentAccessMode) {
                applyBtn.style.display = 'block';
            } else {
                applyBtn.style.display = 'none';
            }
        }

        // Apply mode change (shows confirmation dialog)
        function applyModeChange() {
            if (selectedMode === currentAccessMode) return;

            pendingModeChange = selectedMode;

            // Build confirmation message based on mode
            let message = '';
            if (selectedMode === 'public') {
                message = `<strong>WARNING:</strong> Switching to PUBLIC mode will expose your SPECMEM dashboard to the internet.<br><br>
                           <strong>Security requirements:</strong><br>
                           - Ensure you have a strong password<br>
                           - Consider using HTTPS<br>
                           - Review firewall settings<br><br>
                           The server will restart after this change.`;
            } else if (selectedMode === 'lan') {
                message = `<strong>CAUTION:</strong> Switching to LAN mode will allow access from other devices on your local network.<br><br>
                           Anyone on your network will be able to access this dashboard (with password).<br><br>
                           The server will restart after this change.`;
            } else {
                message = `Switching to PRIVATE mode will restrict access to localhost only.<br><br>
                           This is the most secure option.<br><br>
                           The server will restart after this change.`;
            }

            document.getElementById('modeConfirmMessage').innerHTML = message;
            document.getElementById('modeConfirmOverlay').classList.add('active');
        }

        // Cancel mode change
        function cancelModeChange() {
            pendingModeChange = null;
            document.getElementById('modeConfirmOverlay').classList.remove('active');
        }

        // Confirm mode change
        async function confirmModeChange() {
            if (!pendingModeChange) return;

            const confirmBtn = document.getElementById('confirmModeBtn');
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'APPLYING...';

            try {
                const response = await fetch('/api/settings/access-mode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: pendingModeChange })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentAccessMode = pendingModeChange;
                    selectedMode = pendingModeChange;
                    updateModeIndicators(pendingModeChange);
                    document.getElementById('applyModeBtn').style.display = 'none';

                    showToast(`Access mode changed to ${pendingModeChange.toUpperCase()}. Server restarting...`, 'success');

                    // Close dialogs
                    document.getElementById('modeConfirmOverlay').classList.remove('active');
                    closeSetupModal();

                    // Reload page after a short delay (server restart)
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                } else {
                    showToast(data.error || 'Failed to change access mode', 'error');
                }
            } catch (error) {
                console.error('Mode change error:', error);
                showToast('Failed to change access mode', 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'CONFIRM';
                pendingModeChange = null;
                document.getElementById('modeConfirmOverlay').classList.remove('active');
            }
        }

        // Password strength calculation
        function updatePasswordStrength() {
            const password = document.getElementById('setupNewPassword').value;
            const confirmPassword = document.getElementById('setupConfirmPassword').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
            const updateBtn = document.getElementById('updatePasswordBtn');

            // Check requirements
            const hasLength = password.length >= 8;
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            const passwordsMatch = password === confirmPassword && password.length > 0;

            // Update requirement indicators
            updateRequirement('reqLength', hasLength);
            updateRequirement('reqLower', hasLower);
            updateRequirement('reqUpper', hasUpper);
            updateRequirement('reqNumber', hasNumber);
            updateRequirement('reqSpecial', hasSpecial);
            updateRequirement('reqMatch', passwordsMatch);

            // Calculate strength
            const typesCount = [hasLower, hasUpper, hasNumber, hasSpecial].filter(Boolean).length;
            let strength = 'weak';

            if (password.length >= 16 && typesCount >= 3) {
                strength = 'strong';
            } else if (password.length >= 12 && typesCount >= 2) {
                strength = 'medium';
            } else if (hasLength && typesCount >= 1) {
                strength = 'weak';
            }

            // Update strength bar
            strengthBar.className = 'password-strength-bar';
            if (password.length > 0) {
                strengthBar.classList.add(strength);
            }

            // Enable/disable update button
            const canUpdate = hasLength && passwordsMatch;
            updateBtn.disabled = !canUpdate;
        }

        function updateRequirement(id, met) {
            const req = document.getElementById(id);
            if (req) {
                if (met) {
                    req.classList.add('met');
                    req.querySelector('.password-req-icon').innerHTML = '&#10003;';
                } else {
                    req.classList.remove('met');
                    req.querySelector('.password-req-icon').innerHTML = '&#10005;';
                }
            }
        }

        function resetPasswordForm() {
            const form = document.getElementById('setupPasswordForm');
            if (form) form.reset();

            document.getElementById('passwordStrengthBar').className = 'password-strength-bar';
            document.getElementById('updatePasswordBtn').disabled = true;

            ['reqLength', 'reqLower', 'reqUpper', 'reqNumber', 'reqSpecial', 'reqMatch'].forEach(id => {
                updateRequirement(id, false);
            });
        }

        // Setup password form handler
        document.getElementById('setupPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const currentPassword = document.getElementById('setupCurrentPassword').value;
            const newPassword = document.getElementById('setupNewPassword').value;
            const confirmPassword = document.getElementById('setupConfirmPassword').value;

            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 8) {
                showToast('Password must be at least 8 characters', 'error');
                return;
            }

            const updateBtn = document.getElementById('updatePasswordBtn');
            updateBtn.disabled = true;
            updateBtn.textContent = 'UPDATING...';

            try {
                const response = await fetch('/api/settings/password/change', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword,
                        confirmPassword
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showToast('Password changed successfully!', 'success');
                    resetPasswordForm();
                    loadPasswordStatus(); // Refresh password status indicator
                } else {
                    showToast(data.error || 'Failed to change password', 'error');
                }
            } catch (error) {
                console.error('Password change error:', error);
                showToast('Failed to change password', 'error');
            } finally {
                updateBtn.disabled = false;
                updateBtn.textContent = 'UPDATE PASSWORD';
            }
        });

        // Load access mode on page load
        loadAccessMode();

        // ==================== INITIALIZATION ====================

        // Global language selector instance
        let languageSelector = null;

        function initializeApp() {
            connectWebSocket();
            loadStats();
            loadMemories();
            loadConfig();
            initializeLanguageSelector();
        }

        function initializeLanguageSelector() {
            if (typeof SpecMemLanguageSelector !== 'undefined') {
                languageSelector = new SpecMemLanguageSelector({
                    containerId: 'language-selector-container',
                    onLanguageChange: (langCode, langInfo) => {
                        console.log('Language changed to:', langCode, langInfo);
                        // Emit event for other components to listen
                        document.dispatchEvent(new CustomEvent('specmem-language-change', {
                            detail: { code: langCode, ...langInfo }
                        }));
                    }
                });
            }
        }

        // ==================== WEBSOCKET ====================

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}/ws`);

            ws.onopen = () => {
                // WebSocket connected - update UI status
                document.getElementById('configWsStatus').textContent = 'Connected';
                document.getElementById('configWsStatus').style.color = '#4CAF50';
                reconnectAttempts = 0;
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                handleWebSocketMessage(message);
            };

            ws.onclose = () => {
                // WebSocket disconnected - update UI status
                document.getElementById('configWsStatus').textContent = 'Disconnected';
                document.getElementById('configWsStatus').style.color = '#f44336';

                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    setTimeout(connectWebSocket, 2000 * reconnectAttempts);
                }
            };

            ws.onerror = (error) => {
                // WebSocket error - will trigger onclose
            };
        }

        function handleWebSocketMessage(message) {
            switch (message.type) {
                case 'stats':
                    updateStats(message.data);
                    break;
                case 'memory_deleted':
                    loadMemories();
                    break;
                case 'skills_reloaded':
                    loadSkills();
                    break;
            }
        }

        // ==================== NAVIGATION ====================

        function showSection(sectionId) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionId) {
                    item.classList.add('active');
                }
            });

            // Update sections
            document.querySelectorAll('.section-panel').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId + 'Section').classList.add('active');

            // Load section data
            switch (sectionId) {
                case 'stats': loadStats(); break;
                case 'memories': loadMemories(); break;
                case 'sessions': loadSessions(); break;
                case 'codebase': loadCodebase(); initFileBrowser(); break;
                case 'skills': loadSkills(); break;
                case 'team-members': loadTeamMembers(); break;
            }
        }

        // ==================== STATS ====================

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const stats = await response.json();
                updateStats(stats);
            } catch (error) {
                console.error('Failed to load stats:', error);
                serverLog('error', 'Failed to load stats', { error: error.message });
                // Update with zeros on error
                updateStats({});
            }
        }

        // Store previous stats for animation comparison
        let previousStats = {};

        function updateStats(stats) {
            // Ensure stats is a valid object
            if (!stats || typeof stats !== 'object') {
                stats = {};
            }

            // Helper function to animate stat value updates
            function animateStatUpdate(element, newValue, formatter = formatNumber) {
                if (!element) return;

                const formattedValue = formatter(newValue);
                const currentText = element.textContent;

                if (currentText !== formattedValue) {
                    // Add updating class for animation
                    element.classList.add('updating');
                    element.textContent = formattedValue;

                    // Remove class after animation
                    setTimeout(() => {
                        element.classList.remove('updating');
                    }, 300);
                }
            }

            // Header stats - with animation
            animateStatUpdate(document.getElementById('headerMemories'), stats.totalMemories || 0);
            animateStatUpdate(document.getElementById('headerSessions'), stats.totalSessions || 0);
            animateStatUpdate(document.getElementById('headerFiles'), stats.totalFiles || 0);
            animateStatUpdate(document.getElementById('headerTeamMembers'), stats.activeTeamMembers || 0);

            // Stats cards - with animation
            animateStatUpdate(document.getElementById('statMemories'), stats.totalMemories || 0);
            animateStatUpdate(document.getElementById('statSessions'), stats.totalSessions || 0);
            animateStatUpdate(document.getElementById('statFiles'), stats.totalFiles || 0);
            animateStatUpdate(document.getElementById('statSkills'), stats.totalSkills || 0);
            animateStatUpdate(document.getElementById('statTeamMembers'), stats.activeTeamMembers || 0);
            animateStatUpdate(document.getElementById('statUptime'), stats.uptime || 0, formatUptime);

            // Store for next comparison
            previousStats = { ...stats };
        }

        // ==================== MEMORIES ====================

        async function loadMemories(search = '') {
            const container = document.getElementById('memoriesContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading memories...</div></div>';

            try {
                const url = search ? `/api/memories?search=${encodeURIComponent(search)}` : '/api/memories';
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const memories = data.memories || [];

                if (memories.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128293;</div>
                            <div class="empty-state-title">No Memories Found</div>
                            <div class="empty-state-text">Start creating memories to see them here</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = memories.map(memory => {
                    const memoryId = memory.id || '';
                    const memoryContent = memory.content || '';
                    const memoryTags = memory.tags || [];

                    return `
                    <div class="data-card rarity-${getImportanceRarity(memory.importance)}">
                        <div class="card-header">
                            <span class="card-title">${escapeHtml(memoryId.substring(0, 8))}...</span>
                            <span class="card-meta">${formatDate(memory.created_at)}</span>
                        </div>
                        <div class="card-body">
                            <div class="card-content">${escapeHtml(memoryContent.substring(0, 200))}${memoryContent.length > 200 ? '...' : ''}</div>
                            <div class="card-tags">
                                ${memoryTags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="card-btn" onclick="viewMemory('${escapeHtml(memoryId)}')">View</button>
                            <button class="card-btn delete" onclick="deleteMemory('${escapeHtml(memoryId)}')">Delete</button>
                        </div>
                    </div>
                `}).join('');
            } catch (error) {
                console.error('Failed to load memories:', error);
                serverLog('error', 'Failed to load memories', { error: error.message });
                container.innerHTML = '<div class="alert alert-error">Failed to load memories. Please try again.</div>';
            }
        }

        function searchMemories() {
            const searchInput = document.getElementById('memorySearch');
            const search = searchInput ? searchInput.value : '';
            loadMemories(search);
        }

        async function deleteMemory(id) {
            if (!id) {
                showToast('Invalid memory ID', 'error');
                return;
            }

            if (!confirm('Are you sure you want to delete this memory?')) return;

            try {
                const response = await fetch(`/api/memories/${encodeURIComponent(id)}`, { method: 'DELETE' });
                if (response.ok) {
                    showToast('Memory deleted successfully', 'success');
                    loadMemories();
                } else {
                    const data = await response.json().catch(() => ({}));
                    showToast(data.error || 'Failed to delete memory', 'error');
                }
            } catch (error) {
                console.error('Delete memory error:', error);
                serverLog('error', 'Delete memory error', { error: error.message });
                showToast('Failed to delete memory', 'error');
            }
        }

        async function viewMemory(id) {
            if (!id) {
                showToast('Invalid memory ID', 'error');
                return;
            }

            // Show the modal with loading state
            const overlay = document.getElementById('memoryViewerOverlay');
            const content = document.getElementById('memoryViewerContent');
            overlay.classList.add('active');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading memory...</div></div>';

            try {
                const response = await fetch(`/api/memories/${encodeURIComponent(id)}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        content.innerHTML = '<div class="alert alert-error">Memory not found</div>';
                        return;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                const memory = await response.json();

                // Format metadata for display
                const metadataHtml = memory.metadata && Object.keys(memory.metadata).length > 0
                    ? `<pre style="background: var(--csgo-darker); padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; color: var(--csgo-text-dim);">${escapeHtml(JSON.stringify(memory.metadata, null, 2))}</pre>`
                    : '<span style="color: var(--csgo-text-dim);">No metadata</span>';

                // Format tags
                const tagsHtml = memory.tags && memory.tags.length > 0
                    ? memory.tags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join(' ')
                    : '<span style="color: var(--csgo-text-dim);">No tags</span>';

                content.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span class="form-label">Memory ID</span>
                            <span style="font-family: monospace; color: var(--csgo-yellow);">${escapeHtml(memory.id)}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Type</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600;">${escapeHtml(memory.memory_type || 'general')}</div>
                            </div>
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Importance</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600;">${escapeHtml(memory.importance || 'normal')}</div>
                            </div>
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Access Count</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600;">${memory.access_count || 0}</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="form-label" style="margin-bottom: 8px;">Content</div>
                        <div style="background: var(--csgo-darker); padding: 15px; border-radius: 4px; border-left: 3px solid var(--csgo-yellow); max-height: 300px; overflow-y: auto; white-space: pre-wrap; font-size: 13px; line-height: 1.6;">${escapeHtml(memory.content || '')}</div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="form-label" style="margin-bottom: 8px;">Tags</div>
                        <div class="card-tags">${tagsHtml}</div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="form-label" style="margin-bottom: 8px;">Metadata</div>
                        ${metadataHtml}
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <div class="form-label" style="margin-bottom: 5px;">Created</div>
                            <div style="color: var(--csgo-text);">${formatDate(memory.created_at)}</div>
                        </div>
                        <div>
                            <div class="form-label" style="margin-bottom: 5px;">Last Updated</div>
                            <div style="color: var(--csgo-text);">${formatDate(memory.updated_at)}</div>
                        </div>
                    </div>

                    ${memory.expires_at ? `
                    <div style="margin-bottom: 20px;">
                        <div class="form-label" style="margin-bottom: 5px;">Expires</div>
                        <div style="color: var(--csgo-warning);">${formatDate(memory.expires_at)}</div>
                    </div>
                    ` : ''}

                    <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px; border-top: 1px solid var(--csgo-border);">
                        <button class="btn btn-secondary" onclick="closeMemoryViewer()">Close</button>
                        <button class="btn btn-danger" onclick="closeMemoryViewer(); deleteMemory('${escapeHtml(memory.id)}');">Delete Memory</button>
                    </div>
                `;
            } catch (error) {
                console.error('View memory error:', error);
                serverLog('error', 'View memory error', { error: error.message, memoryId: id });
                content.innerHTML = '<div class="alert alert-error">Failed to load memory details</div>';
            }
        }

        function closeMemoryViewer() {
            document.getElementById('memoryViewerOverlay').classList.remove('active');
        }

        // ==================== SESSIONS ====================

        async function loadSessions() {
            const container = document.getElementById('sessionsContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading sessions...</div></div>';

            try {
                const response = await fetch('/api/sessions');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const sessions = await response.json();
                const sessionList = Array.isArray(sessions) ? sessions : [];

                if (sessionList.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128172;</div>
                            <div class="empty-state-title">No Sessions Found</div>
                            <div class="empty-state-text">Claude sessions will appear here</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="max-height: 600px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Session ID</th>
                                    <th>Started</th>
                                    <th>Last Activity</th>
                                    <th>Messages</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sessionList.map(session => {
                                    const sessionId = session.session_id || session.id || 'N/A';
                                    const displayId = sessionId.length > 12 ? sessionId.substring(0, 12) + '...' : sessionId;
                                    const messageCount = session.message_count || session.messageCount || 0;
                                    return `
                                    <tr style="cursor: pointer;" onclick="viewSession('${escapeHtml(sessionId)}')" class="session-row">
                                        <td style="color: var(--csgo-yellow);">${escapeHtml(displayId)}</td>
                                        <td>${formatDate(session.started_at || session.startedAt)}</td>
                                        <td>${formatDate(session.last_activity || session.lastActivity)}</td>
                                        <td><span style="background: var(--csgo-gray-light); padding: 2px 8px; border-radius: 2px;">${messageCount}</span></td>
                                        <td>
                                            <button class="card-btn" onclick="event.stopPropagation(); viewSession('${escapeHtml(sessionId)}')">View</button>
                                        </td>
                                    </tr>
                                `}).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load sessions:', error);
                serverLog('error', 'Failed to load sessions', { error: error.message });
                container.innerHTML = '<div class="alert alert-error">Failed to load sessions. Please try again.</div>';
            }
        }

        async function viewSession(sessionId) {
            if (!sessionId || sessionId === 'N/A') {
                showToast('Invalid session ID', 'error');
                return;
            }

            const overlay = document.getElementById('sessionViewerOverlay');
            const content = document.getElementById('sessionViewerContent');
            overlay.classList.add('active');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading session...</div></div>';

            try {
                const response = await fetch(`/api/sessions/${encodeURIComponent(sessionId)}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        content.innerHTML = '<div class="alert alert-error">Session not found</div>';
                        return;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                const session = await response.json();
                const messages = session.memories || session.messages || [];

                content.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span class="form-label">Session ID</span>
                            <span style="font-family: monospace; color: var(--csgo-yellow);">${escapeHtml(sessionId)}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Memories</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600;">${session.memory_count || messages.length}</div>
                            </div>
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Types</div>
                                <div style="color: var(--csgo-success); font-weight: 600;">${session.memory_types_used || 1}</div>
                            </div>
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Duration</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600;">${Math.round(session.duration_minutes || 0)}m</div>
                            </div>
                            <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Project</div>
                                <div style="color: var(--csgo-yellow); font-weight: 600; font-size: 11px;">${escapeHtml(session.project || 'N/A')}</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="form-label" style="margin-bottom: 8px;">Session Memories</div>
                        <div style="background: var(--csgo-darker); border-radius: 4px; max-height: 400px; overflow-y: auto; padding: 15px;">
                            ${messages.length > 0 ? messages.map(msg => {
                                const msgType = msg.memory_type || msg.role || 'episodic';
                                const importance = msg.importance || 'medium';
                                const borderColor = importance === 'high' ? 'var(--csgo-error)' : (importance === 'critical' ? '#ff00ff' : 'var(--csgo-yellow)');
                                return `
                                <div style="margin-bottom: 15px; padding: 10px; border-radius: 4px;
                                    background: var(--csgo-gray-light);
                                    border-left: 3px solid ${borderColor};">
                                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 5px;">
                                        <span style="font-size: 10px; text-transform: uppercase; color: var(--csgo-yellow);">${escapeHtml(msgType)}</span>
                                        <span style="font-size: 9px; padding: 2px 6px; background: var(--csgo-dark); border-radius: 3px; color: var(--csgo-text-dim);">${escapeHtml(importance)}</span>
                                        ${msg.tags && msg.tags.length > 0 ? `<span style="font-size: 9px; color: var(--csgo-text-dim);">${msg.tags.slice(0,3).join(', ')}</span>` : ''}
                                    </div>
                                    <div style="font-size: 13px; white-space: pre-wrap; word-break: break-word;">
                                        ${escapeHtml(msg.content || msg.text || '')}
                                    </div>
                                    <div style="font-size: 10px; color: var(--csgo-text-dim); margin-top: 5px;">
                                        ${formatDate(msg.created_at || msg.timestamp)}
                                    </div>
                                </div>
                            `}).join('') : '<div style="color: var(--csgo-text-dim); text-align: center;">No memories in this session</div>'}
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px; border-top: 1px solid var(--csgo-border);">
                        <button class="btn btn-secondary" onclick="closeSessionViewer()">Close</button>
                    </div>
                `;
            } catch (error) {
                console.error('View session error:', error);
                content.innerHTML = '<div class="alert alert-error">Failed to load session details. The session might not exist or the API endpoint is not available.</div>';
            }
        }

        function closeSessionViewer() {
            document.getElementById('sessionViewerOverlay').classList.remove('active');
        }

        // ==================== CODEBASE ====================

        async function loadCodebase(search = '') {
            const container = document.getElementById('codebaseContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading codebase...</div></div>';

            try {
                const url = search ? `/api/codebase?search=${encodeURIComponent(search)}` : '/api/codebase';
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const files = data.files || [];
                const stats = data.stats || {};

                if (files.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128193;</div>
                            <div class="empty-state-title">No Files Indexed</div>
                            <div class="empty-state-text">Enable codebase indexing to browse files</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="margin-bottom: 15px; color: var(--csgo-text-dim);">
                        Total Files: ${stats.totalFiles || files.length} | Total Lines: ${stats.totalLines || 0}
                    </div>
                    <div class="file-tree" style="max-height: 500px; overflow-y: auto;">
                        ${files.map(file => `
                            <div class="file-item" style="cursor: pointer;" onclick="viewFile('${escapeHtml(file.path || '')}')">
                                <span class="file-icon">${getFileIcon(file.language || file.path || '')}</span>
                                <span class="file-name">${escapeHtml(file.path || 'Unknown')}</span>
                                <span class="file-size">${file.lines || 0} lines</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load codebase:', error);
                container.innerHTML = '<div class="alert alert-error">Failed to load codebase. Please try again.</div>';
            }
        }

        function searchCodebase() {
            const searchInput = document.getElementById('codebaseSearch');
            const search = searchInput ? searchInput.value : '';
            loadCodebase(search);
        }

        async function viewFile(filePath) {
            if (!filePath) {
                showToast('Invalid file path', 'error');
                return;
            }

            const overlay = document.getElementById('fileViewerOverlay');
            const content = document.getElementById('fileViewerContent');
            overlay.classList.add('active');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading file...</div></div>';

            try {
                const response = await fetch(`/api/codebase/file?path=${encodeURIComponent(filePath)}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        content.innerHTML = '<div class="alert alert-error">File not found</div>';
                        return;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const fileContent = data.content || '';
                const language = data.language || filePath.split('.').pop() || 'text';

                content.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div>
                                <span class="form-label">File Path</span>
                                <div style="font-family: monospace; color: var(--csgo-yellow); margin-top: 5px;">${escapeHtml(filePath)}</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn" onclick="triggerClaudeEdit('${escapeHtml(filePath)}', 'edit')">
                                    &#9998; Edit with Claude
                                </button>
                                <button class="btn btn-secondary" onclick="triggerClaudeEdit('${escapeHtml(filePath)}', 'improve')">
                                    &#128640; Improve with Claude
                                </button>
                                <button class="btn btn-secondary" onclick="triggerClaudeEdit('${escapeHtml(filePath)}', 'explain')">
                                    &#128161; Explain Code
                                </button>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <div class="form-label" style="margin-bottom: 8px;">File Content (${data.lines || 0} lines)</div>
                        <pre style="background: var(--csgo-darker); padding: 15px; border-radius: 4px; border-left: 3px solid var(--csgo-yellow); max-height: 400px; overflow: auto; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.5; white-space: pre-wrap; word-break: break-word;"><code>${escapeHtml(fileContent)}</code></pre>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px; border-top: 1px solid var(--csgo-border);">
                        <button class="btn btn-secondary" onclick="closeFileViewer()">Close</button>
                    </div>
                `;
            } catch (error) {
                console.error('View file error:', error);
                content.innerHTML = '<div class="alert alert-error">Failed to load file content</div>';
            }
        }

        function closeFileViewer() {
            document.getElementById('fileViewerOverlay').classList.remove('active');
        }

        async function triggerClaudeEdit(filePath, action) {
            let prompt = '';
            switch (action) {
                case 'edit':
                    prompt = `Please review and edit this file: ${filePath}\n\nProvide specific improvements and corrections.`;
                    break;
                case 'improve':
                    prompt = `Please analyze and improve this file: ${filePath}\n\nFocus on:\n- Code quality\n- Performance\n- Best practices\n- Error handling`;
                    break;
                case 'explain':
                    prompt = `Please explain the code in this file: ${filePath}\n\nProvide:\n- Purpose of the file\n- Key functions and their roles\n- How it fits in the codebase`;
                    break;
            }

            showToast(`Triggering Claude ${action} for ${filePath}...`, 'info');

            try {
                const response = await fetch('/api/claude/trigger', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: action === 'explain' ? 'analyze-codebase' : 'custom',
                        prompt: prompt,
                        requireConfirmation: false,
                        context: { filePath: filePath }
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showToast(`Claude ${action} triggered successfully!`, 'success');
                    if (result.response) {
                        const content = document.getElementById('fileViewerContent');
                        content.innerHTML += `
                            <div style="margin-top: 20px; padding: 15px; background: var(--csgo-gray); border-radius: 4px; border-left: 3px solid var(--csgo-success);">
                                <div class="form-label" style="margin-bottom: 10px; color: var(--csgo-success);">Claude Response</div>
                                <div style="white-space: pre-wrap; font-size: 13px;">${escapeHtml(result.response)}</div>
                            </div>
                        `;
                    }
                } else {
                    const data = await response.json().catch(() => ({}));
                    showToast(data.error || `Failed to trigger Claude ${action}`, 'error');
                }
            } catch (error) {
                console.error('Claude trigger error:', error);
                showToast('Failed to trigger Claude action', 'error');
            }
        }

        // ==================== FILE BROWSER (FTP-STYLE) ====================

        // File browser state
        const fileBrowserState = {
            currentPath: '/server',
            selectedPaths: new Set(),
            entries: [],
            filterText: '',
            isLoading: false,
            lastActionTime: 0 // For debouncing
        };

        // Debounce delay in milliseconds (CRITICAL: 500ms to prevent spam clicking crashes)
        const DEBOUNCE_DELAY = 500;

        // Initialize file browser when codebase section is shown
        function initFileBrowser() {
            browsePath('/server');
            setupCodebaseDividerDrag();
        }

        // Browse a directory path
        async function browsePath(targetPath) {
            if (fileBrowserState.isLoading) return;

            fileBrowserState.isLoading = true;
            fileBrowserState.currentPath = targetPath;
            fileBrowserState.selectedPaths.clear();
            updateSelectionButtons();

            const container = document.getElementById('fileBrowserContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading files...</div></div>';

            try {
                const response = await fetch(`/api/file-manager/browse?path=${encodeURIComponent(targetPath)}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                fileBrowserState.entries = data.entries || [];

                // Update breadcrumbs
                renderBreadcrumbs(data.breadcrumbs || []);

                // Render file list
                renderFileBrowserList(data);

            } catch (error) {
                console.error('Failed to browse directory:', error);
                container.innerHTML = '<div class="alert alert-error">Failed to load directory. Please try again.</div>';
            } finally {
                fileBrowserState.isLoading = false;
            }
        }

        // Render breadcrumb navigation
        function renderBreadcrumbs(breadcrumbs) {
            const container = document.getElementById('fileBrowserBreadcrumbs');
            if (!container) return;

            const html = breadcrumbs.map((crumb, index) => {
                const isLast = index === breadcrumbs.length - 1;
                return `
                    <span class="breadcrumb-item ${isLast ? 'current' : ''}" onclick="browsePath('${escapeHtml(crumb.path)}')">${escapeHtml(crumb.name)}</span>
                    ${!isLast ? '<span class="breadcrumb-separator">/</span>' : ''}
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Render the file browser list
        function renderFileBrowserList(data) {
            const container = document.getElementById('fileBrowserContainer');
            if (!container) return;

            const entries = fileBrowserState.filterText
                ? data.entries.filter(e => e.name.toLowerCase().includes(fileBrowserState.filterText.toLowerCase()))
                : data.entries;

            let html = '';

            // Parent directory link
            if (data.parentPath) {
                html += `
                    <div class="file-browser-item parent-dir" onclick="browsePath('${escapeHtml(data.parentPath)}')">
                        <span class="file-browser-icon">&#128281;</span>
                        <span class="file-browser-name">..</span>
                        <span class="file-browser-meta">Parent Directory</span>
                    </div>
                `;
            }

            // File/directory entries
            entries.forEach(entry => {
                const isSelected = fileBrowserState.selectedPaths.has(entry.path);
                const icon = entry.type === 'directory' ? '&#128193;' : getFileIcon(entry.extension || entry.name);
                const sizeStr = entry.type === 'directory' ? '-' : formatBytes(entry.size);
                const dateStr = formatDate(entry.modified);

                html += `
                    <div class="file-browser-item ${isSelected ? 'selected' : ''} ${entry.isInCodebase ? 'in-codebase' : ''}"
                         data-path="${escapeHtml(entry.path)}"
                         data-type="${entry.type}">
                        <input type="checkbox" class="file-browser-checkbox"
                               ${isSelected ? 'checked' : ''}
                               onclick="event.stopPropagation(); toggleFileSelection('${escapeHtml(entry.path)}')">
                        <span class="file-browser-icon ${entry.type === 'directory' ? 'folder' : ''}"
                              onclick="${entry.type === 'directory' ? `browsePath('${escapeHtml(entry.path)}')` : `toggleFileSelection('${escapeHtml(entry.path)}')`}">${icon}</span>
                        <span class="file-browser-name ${entry.isHidden ? 'hidden-file' : ''}"
                              onclick="${entry.type === 'directory' ? `browsePath('${escapeHtml(entry.path)}')` : `toggleFileSelection('${escapeHtml(entry.path)}')`}">${escapeHtml(entry.name)}</span>
                        <div class="file-browser-meta">
                            <span class="file-browser-size">${sizeStr}</span>
                            <span class="file-browser-date">${dateStr}</span>
                        </div>
                    </div>
                `;
            });

            if (entries.length === 0 && !data.parentPath) {
                html = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128193;</div>
                        <div class="empty-state-title">Directory is Empty</div>
                        <div class="empty-state-text">No files or folders found in this directory</div>
                    </div>
                `;
            }

            container.innerHTML = html;
            updateSelectedCount();
        }

        // Toggle file/directory selection
        function toggleFileSelection(filePath) {
            if (fileBrowserState.selectedPaths.has(filePath)) {
                fileBrowserState.selectedPaths.delete(filePath);
            } else {
                fileBrowserState.selectedPaths.add(filePath);
            }

            // Update UI
            const item = document.querySelector(`.file-browser-item[data-path="${CSS.escape(filePath)}"]`);
            if (item) {
                item.classList.toggle('selected');
                const checkbox = item.querySelector('.file-browser-checkbox');
                if (checkbox) checkbox.checked = fileBrowserState.selectedPaths.has(filePath);
            }

            updateSelectedCount();
            updateSelectionButtons();
        }

        // Update selected items count
        function updateSelectedCount() {
            const countEl = document.getElementById('selectedCount');
            if (countEl) {
                const count = fileBrowserState.selectedPaths.size;
                countEl.textContent = `${count} item${count !== 1 ? 's' : ''} selected`;
            }
        }

        // Update add/remove buttons state
        function updateSelectionButtons() {
            const addBtn = document.getElementById('addToCodebaseBtn');
            const removeBtn = document.getElementById('removeFromCodebaseBtn');
            const hasSelection = fileBrowserState.selectedPaths.size > 0;

            if (addBtn) addBtn.disabled = !hasSelection;
            if (removeBtn) removeBtn.disabled = !hasSelection;
        }

        // Filter file browser by name
        function filterFileBrowser(filterText) {
            fileBrowserState.filterText = filterText;
            // Re-render with current data
            const data = {
                entries: fileBrowserState.entries,
                parentPath: fileBrowserState.currentPath !== '/' ? getParentPath(fileBrowserState.currentPath) : null
            };
            renderFileBrowserList(data);
        }

        // Get parent path
        function getParentPath(currentPath) {
            const parts = currentPath.split('/').filter(p => p);
            parts.pop();
            return '/' + parts.join('/');
        }

        // Add selected items to codebase with debouncing
        async function addSelectedToCodebase() {
            // CRITICAL: 500ms debounce to prevent spam clicking crashes
            const now = Date.now();
            if (now - fileBrowserState.lastActionTime < DEBOUNCE_DELAY) {
                showToast('Please wait before clicking again', 'warning');
                return;
            }
            fileBrowserState.lastActionTime = now;

            const paths = Array.from(fileBrowserState.selectedPaths);
            if (paths.length === 0) {
                showToast('No items selected', 'warning');
                return;
            }

            const addBtn = document.getElementById('addToCodebaseBtn');
            if (addBtn) {
                addBtn.disabled = true;
                addBtn.textContent = 'Adding...';
            }

            try {
                const response = await fetch('/api/file-manager/add-to-codebase', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ paths })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    const summary = result.summary || {};
                    showToast(`Added ${summary.added || 0} files to codebase`, 'success');

                    // Refresh both views
                    await Promise.all([
                        browsePath(fileBrowserState.currentPath),
                        loadCodebase()
                    ]);
                } else {
                    showToast(result.error || 'Failed to add files', 'error');
                }
            } catch (error) {
                console.error('Add to codebase error:', error);
                showToast('Failed to add files to codebase', 'error');
            } finally {
                if (addBtn) {
                    addBtn.disabled = false;
                    addBtn.textContent = 'Add Selected';
                }
            }
        }

        // Remove selected items from codebase with debouncing
        async function removeSelectedFromCodebase() {
            // CRITICAL: 500ms debounce to prevent spam clicking crashes
            const now = Date.now();
            if (now - fileBrowserState.lastActionTime < DEBOUNCE_DELAY) {
                showToast('Please wait before clicking again', 'warning');
                return;
            }
            fileBrowserState.lastActionTime = now;

            const paths = Array.from(fileBrowserState.selectedPaths);
            if (paths.length === 0) {
                showToast('No items selected', 'warning');
                return;
            }

            const removeBtn = document.getElementById('removeFromCodebaseBtn');
            if (removeBtn) {
                removeBtn.disabled = true;
                removeBtn.textContent = 'Removing...';
            }

            try {
                const response = await fetch('/api/file-manager/remove-from-codebase', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ paths })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    const summary = result.summary || {};
                    showToast(`Removed ${summary.totalFilesRemoved || 0} files from codebase`, 'success');

                    // Refresh both views
                    await Promise.all([
                        browsePath(fileBrowserState.currentPath),
                        loadCodebase()
                    ]);
                } else {
                    showToast(result.error || 'Failed to remove files', 'error');
                }
            } catch (error) {
                console.error('Remove from codebase error:', error);
                showToast('Failed to remove files from codebase', 'error');
            } finally {
                if (removeBtn) {
                    removeBtn.disabled = false;
                    removeBtn.textContent = 'Remove Selected';
                }
            }
        }

        // Setup draggable divider for split view
        function setupCodebaseDividerDrag() {
            const divider = document.getElementById('codebaseDivider');
            const topPane = document.getElementById('codebaseTopPane');
            const bottomPane = document.getElementById('codebaseBottomPane');
            const container = document.querySelector('.codebase-split-container');

            if (!divider || !topPane || !bottomPane || !container) return;

            let isDragging = false;
            let startY = 0;
            let startTopHeight = 0;

            divider.addEventListener('mousedown', (e) => {
                isDragging = true;
                startY = e.clientY;
                startTopHeight = topPane.offsetHeight;
                divider.classList.add('dragging');
                document.body.style.cursor = 'row-resize';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaY = e.clientY - startY;
                const containerHeight = container.offsetHeight;
                const newTopHeight = Math.max(100, Math.min(containerHeight - 200, startTopHeight + deltaY));
                const newBottomHeight = containerHeight - newTopHeight - 8; // 8px for divider

                topPane.style.flex = 'none';
                topPane.style.height = newTopHeight + 'px';
                bottomPane.style.flex = 'none';
                bottomPane.style.height = newBottomHeight + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    divider.classList.remove('dragging');
                    document.body.style.cursor = '';
                }
            });
        }

        // ==================== SKILLS ====================

        let skillsCache = [];

        async function loadSkills() {
            const container = document.getElementById('skillsContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading skills...</div></div>';

            try {
                const response = await fetch('/api/skills');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const skills = data.skills || [];
                skillsCache = skills;

                if (skills.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#9889;</div>
                            <div class="empty-state-title">No Skills Loaded</div>
                            <div class="empty-state-text">Add .md files to your skills directory</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = skills.map((skill, index) => `
                    <div class="data-card rarity-rare" style="cursor: pointer;" onclick="viewSkill(${index})">
                        <div class="card-header">
                            <span class="card-title">${escapeHtml(skill.name || 'Unnamed')}</span>
                            <span class="card-meta">${escapeHtml(skill.category || 'default')}</span>
                        </div>
                        <div class="card-body">
                            <div class="card-content">${escapeHtml(skill.description || 'No description')}</div>
                            <div class="card-tags">
                                <span class="tag">${formatBytes(skill.size || 0)}</span>
                                <span class="tag">${escapeHtml(skill.path ? skill.path.split('/').pop() : 'unknown')}</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="card-btn" onclick="event.stopPropagation(); viewSkill(${index})">View</button>
                            <button class="card-btn" onclick="event.stopPropagation(); editSkill(${index})">Edit</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load skills:', error);
                container.innerHTML = '<div class="alert alert-error">Failed to load skills. Please try again.</div>';
            }
        }

        async function viewSkill(index) {
            const skill = skillsCache[index];
            if (!skill) {
                showToast('Skill not found', 'error');
                return;
            }

            const overlay = document.getElementById('skillEditorOverlay');
            const content = document.getElementById('skillEditorContent');
            overlay.classList.add('active');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading skill...</div></div>';

            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <span class="form-label">Skill Name</span>
                            <div style="font-family: 'Orbitron', monospace; color: var(--csgo-yellow); font-size: 18px; margin-top: 5px;">${escapeHtml(skill.name || 'Unnamed')}</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="editSkill(${index})">&#9998; Edit Skill</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                            <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Category</div>
                            <div style="color: var(--csgo-yellow); font-weight: 600;">${escapeHtml(skill.category || 'default')}</div>
                        </div>
                        <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                            <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">Size</div>
                            <div style="color: var(--csgo-yellow); font-weight: 600;">${formatBytes(skill.size || 0)}</div>
                        </div>
                        <div style="background: var(--csgo-darker); padding: 12px; border-radius: 4px; text-align: center;">
                            <div style="font-size: 11px; text-transform: uppercase; color: var(--csgo-text-dim); margin-bottom: 5px;">File</div>
                            <div style="color: var(--csgo-yellow); font-weight: 600; font-size: 11px; word-break: break-all;">${escapeHtml(skill.path ? skill.path.split('/').pop() : 'N/A')}</div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div class="form-label" style="margin-bottom: 8px;">Description</div>
                    <div style="background: var(--csgo-darker); padding: 15px; border-radius: 4px; border-left: 3px solid var(--csgo-yellow);">
                        ${escapeHtml(skill.description || 'No description')}
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div class="form-label" style="margin-bottom: 8px;">Skill Content</div>
                    <pre style="background: var(--csgo-darker); padding: 15px; border-radius: 4px; max-height: 300px; overflow: auto; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.5; white-space: pre-wrap;">${escapeHtml(skill.content || skill.rawContent || 'No content available')}</pre>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px; border-top: 1px solid var(--csgo-border);">
                    <button class="btn btn-secondary" onclick="closeSkillEditor()">Close</button>
                </div>
            `;
        }

        async function editSkill(index) {
            const skill = skillsCache[index];
            if (!skill) {
                showToast('Skill not found', 'error');
                return;
            }

            const overlay = document.getElementById('skillEditorOverlay');
            const content = document.getElementById('skillEditorContent');
            overlay.classList.add('active');

            const skillContent = skill.content || skill.rawContent || '';

            content.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="form-label">Editing Skill</span>
                            <div style="font-family: 'Orbitron', monospace; color: var(--csgo-yellow); font-size: 18px; margin-top: 5px;">${escapeHtml(skill.name || 'Unnamed')}</div>
                        </div>
                        <div style="color: var(--csgo-text-dim); font-size: 12px;">
                            ${escapeHtml(skill.path || 'Unknown path')}
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <label class="form-label" style="margin-bottom: 8px; display: block;">Skill Content (Markdown)</label>
                    <textarea id="skillEditorTextarea" style="width: 100%; height: 400px; background: var(--csgo-darker); border: 1px solid var(--csgo-border); border-radius: 4px; padding: 15px; color: var(--csgo-text); font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5; resize: vertical;">${escapeHtml(skillContent)}</textarea>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px; border-top: 1px solid var(--csgo-border);">
                    <button class="btn btn-secondary" onclick="closeSkillEditor()">Cancel</button>
                    <button class="btn" onclick="saveSkill(${index})">&#128190; Save Skill</button>
                </div>
            `;

            document.getElementById('skillEditorTextarea').focus();
        }

        async function saveSkill(index) {
            const skill = skillsCache[index];
            if (!skill || !skill.name) {
                showToast('Cannot save skill - no skill name', 'error');
                return;
            }

            const textarea = document.getElementById('skillEditorTextarea');
            if (!textarea) {
                showToast('Editor not found', 'error');
                return;
            }

            const newContent = textarea.value;
            showToast('Saving skill...', 'info');

            try {
                // Use the proper PUT endpoint for skill editing
                const response = await fetch(`/api/skills/${encodeURIComponent(skill.name)}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: newContent })
                });

                if (response.ok) {
                    showToast('Skill saved successfully! Reloading skills...', 'success');
                    closeSkillEditor();
                    await loadSkills();  // Reload skills to reflect changes
                } else {
                    const data = await response.json().catch(() => ({}));
                    showToast(data.error || 'Failed to save skill', 'error');
                }
            } catch (error) {
                console.error('Save skill error:', error);
                showToast('Failed to save skill', 'error');
            }
        }

        function closeSkillEditor() {
            document.getElementById('skillEditorOverlay').classList.remove('active');
        }

        async function reloadSkills() {
            try {
                showToast('Reloading skills...', 'info');
                const response = await fetch('/api/skills/reload', { method: 'POST' });
                if (response.ok) {
                    showToast('Skills reloaded successfully', 'success');
                    loadSkills();
                } else {
                    const data = await response.json().catch(() => ({}));
                    showToast(data.error || 'Failed to reload skills', 'error');
                }
            } catch (error) {
                console.error('Reload skills error:', error);
                showToast('Failed to reload skills', 'error');
            }
        }

        // ==================== AGENTS ====================

        async function loadTeamMembers() {
            const container = document.getElementById('teamMembersContainer');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Loading team members...</div></div>';

            try {
                const response = await fetch('/api/teamMembers');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const teamMembers = await response.json();
                const teamMemberList = Array.isArray(teamMembers) ? team members : [];

                if (agentList.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128101;</div>
                            <div class="empty-state-title">No Active Team Members</div>
                            <div class="empty-state-text">TeamMembers will appear when they connect</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = team memberList.map(team member => {
                    const teamMemberName = team member.name || 'Unknown';
                    const teamMemberType = teamMember.type || 'team-member';
                    const isConnected = !!teamMember.connected;

                    return `
                    <div class="team-member-card">
                        <div class="team-member-avatar">${escapeHtml(teamMemberName.charAt(0))}</div>
                        <div class="team-member-info">
                            <div class="team-member-name">${escapeHtml(teamMemberName)}</div>
                            <div class="team-member-type">${escapeHtml(teamMemberType)}</div>
                            <div class="team-member-status">
                                <span class="status-dot ${isConnected ? '' : 'offline'}"></span>
                                ${isConnected ? 'Online' : 'Offline'}
                            </div>
                        </div>
                    </div>
                `}).join('');
            } catch (error) {
                console.error('Failed to load team members:', error);
                serverLog('error', 'Failed to load team members', { error: error.message });
                container.innerHTML = '<div class="alert alert-error">Failed to load team members. Please try again.</div>';
            }
        }

        // ==================== CONFIG ====================

        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const config = await response.json();

                const coordPort = document.getElementById('configCoordPort');
                const dashPort = document.getElementById('configDashPort');

                if (coordPort) coordPort.textContent = config.coordinationPort || '8588';
                if (dashPort) dashPort.textContent = config.dashboardPort || '8589';
            } catch (error) {
                console.error('Failed to load config:', error);
                serverLog('error', 'Failed to load config', { error: error.message });
            }
        }

        // Change password form handler
        const changePasswordForm = document.getElementById('changePasswordForm');
        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const currentPasswordEl = document.getElementById('currentPassword');
                const newPasswordEl = document.getElementById('newPassword');
                const confirmPasswordEl = document.getElementById('confirmPassword');

                const currentPassword = currentPasswordEl ? currentPasswordEl.value : '';
                const newPassword = newPasswordEl ? newPasswordEl.value : '';
                const confirmPassword = confirmPasswordEl ? confirmPasswordEl.value : '';

                if (newPassword !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }

                if (newPassword.length < 8) {
                    showToast('Password must be at least 8 characters', 'error');
                    return;
                }

                try {
                    const response = await fetch('/api/config/password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ currentPassword, newPassword })
                    });

                    if (response.ok) {
                        showToast('Password changed successfully', 'success');
                        changePasswordForm.reset();
                    } else {
                        const data = await response.json();
                        showToast(data.error || 'Failed to change password', 'error');
                    }
                } catch (error) {
                    console.error('Password change error:', error);
                    serverLog('error', 'Password change error', { error: error.message });
                    showToast('Failed to change password', 'error');
                }
            });
        }

        // ==================== UTILITIES ====================

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) {
                console.warn('Toast container not found');
                return;
            }

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            // Add type-specific styling
            if (type === 'success') {
                toast.style.borderColor = 'var(--csgo-success)';
            } else if (type === 'error') {
                toast.style.borderColor = 'var(--csgo-error)';
            } else if (type === 'warning') {
                toast.style.borderColor = 'var(--csgo-warning)';
            } else {
                toast.style.borderColor = 'var(--csgo-yellow)';
            }

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function formatNumber(num) {
            if (num === null || num === undefined || isNaN(num)) return '0';
            num = Number(num);
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatUptime(ms) {
            if (ms === null || ms === undefined || isNaN(ms)) return '0m';
            ms = Number(ms);
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            if (hours > 0) return `${hours}h ${minutes}m`;
            return `${minutes}m`;
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        function formatBytes(bytes) {
            if (bytes === null || bytes === undefined || isNaN(bytes)) return '0 B';
            bytes = Number(bytes);
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1048576).toFixed(1) + ' MB';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getImportanceRarity(importance) {
            switch (importance) {
                case 'critical': return 'contraband';
                case 'high': return 'legendary';
                case 'medium': return 'mythical';
                case 'low': return 'rare';
                case 'trivial': return 'uncommon';
                default: return 'common';
            }
        }

        function getFileIcon(pathOrLang) {
            if (!pathOrLang || typeof pathOrLang !== 'string') return '&#128196;';
            const ext = pathOrLang.split('.').pop()?.toLowerCase() || pathOrLang.toLowerCase();
            const icons = {
                'ts': '&#128220;', 'js': '&#128220;', 'tsx': '&#128220;', 'jsx': '&#128220;',
                'py': '&#128013;', 'rb': '&#128142;', 'go': '&#128029;', 'rs': '&#128295;',
                'json': '&#128203;', 'yaml': '&#128203;', 'yml': '&#128203;',
                'md': '&#128196;', 'txt': '&#128196;',
                'css': '&#127912;', 'scss': '&#127912;', 'html': '&#127760;',
                'sql': '&#128451;', 'sh': '&#128424;', 'bash': '&#128424;'
            };
            return icons[ext] || '&#128196;';
        }

        // ==================== MOBILE DETECTION & HELPERS ====================

        const mobileHelpers = {
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            isMobile: false,
            isSmallScreen: false,
            isTouchDevice: false,

            detectDevice() {
                this.screenWidth = window.innerWidth;
                this.screenHeight = window.innerHeight;
                this.isMobile = this.screenWidth <= 480;
                this.isSmallScreen = this.screenWidth <= 400 && this.screenHeight <= 450;
                this.isTouchDevice = ('ontouchstart' in window) ||
                    (navigator.maxTouchPoints > 0) ||
                    (navigator.msMaxTouchPoints > 0);

                // Update CSS custom properties for dynamic sizing
                document.documentElement.style.setProperty('--screen-width', this.screenWidth + 'px');
                document.documentElement.style.setProperty('--screen-height', this.screenHeight + 'px');
                document.documentElement.style.setProperty('--safe-vh', (this.screenHeight * 0.01) + 'px');

                // Add device classes to body
                document.body.classList.toggle('is-mobile', this.isMobile);
                document.body.classList.toggle('is-small-screen', this.isSmallScreen);
                document.body.classList.toggle('is-touch', this.isTouchDevice);

                // Screen info logged for debugging - removed console.log for production
            },

            preventZoom() {
                // Prevent double-tap zoom on buttons
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);

                // Prevent pinch zoom on iOS
                document.addEventListener('gesturestart', (e) => {
                    e.preventDefault();
                }, { passive: false });
            },

            handleOrientationChange() {
                setTimeout(() => {
                    this.detectDevice();
                    // Force recalculation of vh units (iOS fix)
                    document.body.style.height = window.innerHeight + 'px';
                }, 100);
            },

            enableSmoothScroll() {
                // Add momentum scrolling for iOS
                const scrollContainers = document.querySelectorAll('.modal-body, .nav-panel, .data-table');
                scrollContainers.forEach(container => {
                    container.style.webkitOverflowScrolling = 'touch';
                });
            },

            init() {
                this.detectDevice();
                this.preventZoom();
                this.enableSmoothScroll();

                // Listen for resize and orientation changes
                window.addEventListener('resize', () => this.detectDevice());
                window.addEventListener('orientationchange', () => this.handleOrientationChange());

                // Fix for iOS 100vh issue
                const setVH = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                };
                setVH();
                window.addEventListener('resize', setVH);
            }
        };

        // ==================== INIT ====================

        // Initialize mobile helpers
        mobileHelpers.init();

        // Check auth on page load
        checkAuthStatus();

        // Enter key on search inputs
        const memorySearchInput = document.getElementById('memorySearch');
        if (memorySearchInput) {
            memorySearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchMemories();
            });
        }

        const codebaseSearchInput = document.getElementById('codebaseSearch');
        if (codebaseSearchInput) {
            codebaseSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchCodebase();
            });
        }

        // Touch-friendly navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('touchstart', function() {
                this.classList.add('touching');
            }, { passive: true });
            item.addEventListener('touchend', function() {
                this.classList.remove('touching');
            }, { passive: true });
        });

        // Close modals on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    if (modal.id !== 'loginOverlay') {
                        modal.classList.remove('active');
                    }
                });
            }
        });

        // Prevent body scroll when modal is open on mobile
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.target.classList.contains('active')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            });
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            observer.observe(modal, { attributes: true, attributeFilter: ['class'] });
        });
    </script>
</body>
</html>
